(self.webpackChunkwiki=self.webpackChunkwiki||[]).push([[9067],{3905:function(n,e,t){"use strict";t.d(e,{Zo:function(){return m},kt:function(){return s}});var i=t(67294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function a(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function p(n,e){if(null==n)return{};var t,i,r=function(n,e){if(null==n)return{};var t,i,r={},l=Object.keys(n);for(i=0;i<l.length;i++)t=l[i],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(i=0;i<l.length;i++)t=l[i],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var u=i.createContext({}),o=function(n){var e=i.useContext(u),t=e;return n&&(t="function"==typeof n?n(e):a(a({},e),n)),t},m=function(n){var e=o(n.components);return i.createElement(u.Provider,{value:e},n.children)},c={inlineCode:"code",wrapper:function(n){var e=n.children;return i.createElement(i.Fragment,{},e)}},k=i.forwardRef((function(n,e){var t=n.components,r=n.mdxType,l=n.originalType,u=n.parentName,m=p(n,["components","mdxType","originalType","parentName"]),k=o(t),s=r,d=k["".concat(u,".").concat(s)]||k[s]||c[s]||l;return t?i.createElement(d,a(a({ref:e},m),{},{components:t})):i.createElement(d,a({ref:e},m))}));function s(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var l=t.length,a=new Array(l);a[0]=k;var p={};for(var u in e)hasOwnProperty.call(e,u)&&(p[u]=e[u]);p.originalType=n,p.mdxType="string"==typeof n?n:r,a[1]=p;for(var o=2;o<l;o++)a[o]=t[o];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}k.displayName="MDXCreateElement"},38066:function(n,e,t){"use strict";t.r(e),t.d(e,{frontMatter:function(){return p},metadata:function(){return u},toc:function(){return o},default:function(){return c}});var i=t(22122),r=t(19756),l=(t(67294),t(3905)),a=["components"],p={id:"D2.\u8fdb\u7a0b",title:"D2.\u8fdb\u7a0b","typora-root-url":"../"},u={unversionedId:"Server/D2.\u8fdb\u7a0b",id:"Server/D2.\u8fdb\u7a0b",isDocsHomePage:!1,title:"\u8fdb\u7a0b",description:"\u8fdb\u7a0b",source:"@site/docs/7.Server/D2.\u8fdb\u7a0b.md",sourceDirName:"7.Server",slug:"/Server/D2.\u8fdb\u7a0b",permalink:"/Server/D2.\u8fdb\u7a0b",editUrl:"https://github.com/worst0/wiki_note/edit/main/docs/7.Server/D2.\u8fdb\u7a0b.md",version:"current",frontMatter:{id:"D2.\u8fdb\u7a0b",title:"D2.\u8fdb\u7a0b","typora-root-url":"../"},sidebar:"Document\ud83d\udcbb",previous:{title:"D1.\u591a\u8fdb\u7a0b\u7f16\u7a0b",permalink:"/Server/D1.\u591a\u8fdb\u7a0b\u7f16\u7a0b"},next:{title:"IPC\uff1a\u8fdb\u7a0b\u95f4\u901a\u4fe1",permalink:"/Server/D4.\u8fdb\u7a0b\u95f4\u901a\u4fe1"}},o=[{value:"\u8fdb\u7a0b",id:"\u8fdb\u7a0b",children:[{value:"\u8fdb\u7a0b\u7684\u521b\u5efa",id:"\u8fdb\u7a0b\u7684\u521b\u5efa",children:[]},{value:"\u8fdb\u7a0b\u7684\u53d8\u8eab",id:"\u8fdb\u7a0b\u7684\u53d8\u8eab",children:[]},{value:"\u8fdb\u7a0b\u7684\u9000\u51fa",id:"\u8fdb\u7a0b\u7684\u9000\u51fa",children:[]}]},{value:"\u5b64\u513f\u8fdb\u7a0b",id:"\u5b64\u513f\u8fdb\u7a0b",children:[]},{value:"\u50f5\u5c38\u8fdb\u7a0b",id:"\u50f5\u5c38\u8fdb\u7a0b",children:[{value:"git\u8fdb\u7a0b\u7684\u534f\u540c\u8c03\u7528",id:"git\u8fdb\u7a0b\u7684\u534f\u540c\u8c03\u7528",children:[]},{value:"\u8fdb\u7a0b\u8c03\u5ea6",id:"\u8fdb\u7a0b\u8c03\u5ea6",children:[]},{value:"\u534f\u540c\u5f0f\u548c\u62a2\u5360\u5f0f",id:"\u534f\u540c\u5f0f\u548c\u62a2\u5360\u5f0f",children:[]},{value:"\u65f6\u95f4\u7247",id:"\u65f6\u95f4\u7247",children:[]}]},{value:"\u521b\u5efa\u591a\u4e2a\u5b50\u8fdb\u7a0b",id:"\u521b\u5efa\u591a\u4e2a\u5b50\u8fdb\u7a0b",children:[]},{value:"\u901a\u8fc7\u6587\u4ef6\u9501\u5199\u5165\u6587\u4ef6\uff0c\u591a\u8fdb\u7a0b\u7d2f\u52a0",id:"\u901a\u8fc7\u6587\u4ef6\u9501\u5199\u5165\u6587\u4ef6\uff0c\u591a\u8fdb\u7a0b\u7d2f\u52a0",children:[{value:"1.struct\u7ed3\u6784\u4f53",id:"1struct\u7ed3\u6784\u4f53",children:[]},{value:"2.\u53d8\u91cf",id:"2\u53d8\u91cf",children:[]}]}],m={toc:o};function c(n){var e=n.components,p=(0,r.Z)(n,a);return(0,l.kt)("wrapper",(0,i.Z)({},m,p,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u8fdb\u7a0b"},"\u8fdb\u7a0b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8d44\u6e90\u5206\u914d\u4e0e\u8c03\u5ea6\u7684\u6700\u5c0f\u5355\u4f4d\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u5728\u5185\u5b58\u4e2d\u7684\u955c\u50cf"),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u4e0d\u662f\u51ed\u7a7a\u4ea7\u751f\u7684\uff0c\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u8fdb\u7a0b\u90fd\u662f\u7531systemd\u8fdb\u7a0b\u514b\u9686\u800c\u6765\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u901a\u8fc7fork\uff08\uff09\u51fd\u6570\u590d\u5236\uff0c\u800c\u540e\u901a\u8fc7exec\uff08\uff09\u51fd\u6570\u6765\u8fdb\u884c\u201c\u53d8\u8eab\u201d\uff0c\u53bb\u5b8c\u6210\u5404\u79cd\u5404\u6837\u7684\u4efb\u52a1\u3002")),(0,l.kt)("p",null,"\u5185\u6838kernel\u5c06\u4e0a\u5c42\u5e94\u7528\u4e0e\u786c\u4ef6\u8fde\u63a5\u8d77\u6765,\u9a71\u52a8\u786c\u4ef6;"),(0,l.kt)("p",null,"\u6211\u4eec\u4e00\u76f4\u5728zsh\u4e2d,which\u662f\u5426\u5185\u7f6e\u4e0eshell,",(0,l.kt)("inlineCode",{parentName:"p"},"echo $0")),(0,l.kt)("p",null,"\u7a0b\u5e8f:\u53ef\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6"),(0,l.kt)("p",null,"systemd\u8fdb\u7a0b:1\u53f7\u8fdb\u7a0b,\u800c\u975einit(\u6dd8\u6c70)"),(0,l.kt)("h3",{id:"\u8fdb\u7a0b\u7684\u521b\u5efa"},"\u8fdb\u7a0b\u7684\u521b\u5efa"),(0,l.kt)("p",null,"\u5728\u7cfb\u7edf\u4e2d\uff0c\u6240\u6709\u7684\u8fdb\u7a0b\u90fd\u662f\u75311\u53f7\u8fdb\u7a0b\u514b\u9686\u800c\u6765\uff0c\u5728\u6211\u4eec\u8fdb\u884c\u7cfb\u7edf\u7f16\u7a0b\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528fork\u51fd\u6570\u6765\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u88ab\u514b\u9686\u7684\u8fdb\u7a0b\u53eb\u505a\u7236\u8fdb\u7a0b\u3002\n\u7236\u5b50\u8fdb\u7a0b\u5728\u521b\u5efa\u540e\uff0c\u57fa\u672c\u76f8\u540c\uff0c\u9664\u4e86\u4ee5\u4e0b\u51e0\u70b9"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5b50\u8fdb\u7a0b\u7684pid\u662f\u65b0\u5206\u914d\u7684\uff0c\u4e0e\u7236\u8fdb\u7a0b\u4e0d\u540c"),(0,l.kt)("li",{parentName:"ol"},"\u5b50\u8fdb\u7a0b\u7684ppid\u4f1a\u8bbe\u7f6e\u4e3a\u7236\u8fdb\u7a0b\u7684pid"),(0,l.kt)("li",{parentName:"ol"},"\u5b50\u8fdb\u7a0b\u4e2d\u7684\u8d44\u6e90\u7edf\u8ba1\u4fe1\u606f\u4f1a\u6e05\u96f6"),(0,l.kt)("li",{parentName:"ol"},"\u6240\u6709\u6302\u8d77\u7684\u4fe1\u53f7\u90fd\u4f1a\u88ab\u6e05\u9664\uff0c\u4e0d\u4f1a\u88ab\u5b50\u8fdb\u7a0b\u7ee7\u627f"),(0,l.kt)("li",{parentName:"ol"},"\u6240\u6709\u6587\u4ef6\u9501\u4e5f\u4e0d\u4f1a\u88ab\u5b50\u8fdb\u7a0b\u7ee7\u627f")),(0,l.kt)("p",null,"ppid:parent process id"),(0,l.kt)("p",null,"\u8d44\u6e90\u7edf\u8ba1\u4fe1\u606f:time \u547d\u4ee4"),(0,l.kt)("p",null,"\u4fe1\u53f7:\u4fe1\u53f7\u662f\u660e\u786e\u7ed9\u67d0\u4e00\u8fdb\u7a0b"),(0,l.kt)("p",null,"\u5185\u5b58\u6e05\u9664:\u5c31\u662f\u91cd\u5199"),(0,l.kt)("p",null,"==\u5199\u62f7\u8d1d== :\n\u5728exec\u4e4b\u524d \u4e24\u4e2a\u8fdb\u7a0b\u7528\u7684\u662f \u76f8\u540c\u7684\u7269\u7406\u7a7a\u95f4\uff08\u5185\u5b58\u533a\uff09\uff08\u6240\u8c13\u7528\u662f\u53ea\u8bfb\uff0c\u4e0d\u80fd\u5199\u7684\uff09\uff0c\u5b50\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\u3001\u6570\u636e\u6bb5\u3001\u5806\u6808\u90fd\u662f\u6307\u5411\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u7a7a\u95f4 \u3002\u5f53\u7236\u5b50\u8fdb\u7a0b\u4e2d\u6709 \u66f4\u6539\u76f8\u5e94\u6bb5\u7684\u884c\u4e3a\u53d1\u751f \u65f6\uff0c\u518d \u4e3a\u5b50\u8fdb\u7a0b\u76f8\u5e94\u7684\u6bb5\u5206\u914d\u7269\u7406\u7a7a\u95f4\uff08\u8fd9\u65f6\u521b\u5efa\u62f7\u8d1d\u7684\u8fdb\u7a0b\u7684\u9875\u8868\u6761\u76ee\u4f1a\u6307\u5411\u8fd9\u4e2a\u65b0\u7684\u7269\u7406\u9875\u9762\uff08\u62f7\u8d1d\uff09\uff0c\u7136\u540e\u6062\u590d\u8fd9\u4e2a\u9875\u9762\u7684\u53ef\u5199\u6743\u9650\uff09 \uff0c\u5982\u679c\u4e0d\u662f\u56e0\u4e3aexec\uff0c\u5185\u6838\u4f1a\u7ed9 \u5b50\u8fdb\u7a0b\u7684\u6570\u636e\u6bb5\u3001\u5806\u6808\u6bb5\u5206\u914d\u76f8\u5e94\u7684\u7269\u7406\u7a7a\u95f4 \uff08\u81f3\u6b64\u4e24\u8005\u6709\u5404\u81ea\u7684\u8fdb\u7a0b\u7a7a\u95f4\uff0c\u4e92\u4e0d\u5f71\u54cd\uff09\uff0c\u800c\u4ee3\u7801\u6bb5\u7ee7\u7eed\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u7a7a\u95f4\uff08\u4e24\u8005\u7684\u4ee3\u7801\u5b8c\u5168\u76f8\u540c\uff09\u3002\u800c\u5982\u679c\u662f\u56e0\u4e3aexec\uff0c\u7531\u4e8e\u4e24\u8005\u6267\u884c\u7684\u4ee3\u7801\u4e0d\u540c\uff0c \u5b50\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\u4e5f\u4f1a\u5206\u914d\u5355\u72ec\u7684\u7269\u7406\u7a7a\u95f4 \u3002\n\u901a\u5e38\u6765\u8bf4\uff0cfork\u51fd\u6570\u7684\u4ee3\u7801\u6bb5\u57fa\u672c\u662f\u53ea\u8bfb\u7c7b\u578b\u7684\uff0c\u800c\u4e14\u5728\u8fd0\u884c\u9636\u6bb5\u4e5f\u53ea\u662f\u590d\u5236\uff0c\u5e76\u4e0d\u4f1a\u5bf9\u5185\u5bb9\u8fdb\u884c\u4fee\u6539\uff0c\u56e0\u6b64\u7236\u5b50\u8fdb\u7a0b\u662f\u5171\u4eab\u4ee3\u7801\u6bb5\uff0c\u800c\u6570\u636e\u6bb5\u3001Bss\u6bb5\u3001\u5806\u6808\u6bb5\u7b49\u4f1a\u5728\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5199\u8fc7\u7a0b\uff0c\u8fd9\u6837\u5c31\u5bfc\u81f4\u4e86\u4e0d\u540c\u7684\u6bb5\u53d1\u751f\u76f8\u5e94\u7684\u5199\u65f6\u62f7\u8d1d\u8fc7\u7a0b\uff0c\u5b9e\u73b0\u4e86\u4e0d\u540c\u8fdb\u7a0b\u7684\u72ec\u7acb\u7a7a\u95f4"),(0,l.kt)("h3",{id:"\u8fdb\u7a0b\u7684\u53d8\u8eab"},"\u8fdb\u7a0b\u7684\u53d8\u8eab"),(0,l.kt)("p",null,"\u5f62\u5f0f\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"exec\\[lv][pe]")),(0,l.kt)("p",null,"list\uff0cpath\uff0cvector"),(0,l.kt)("p",null,"vector:\u4e8c\u7ef4\u6570\u7ec4,main\u4e3b\u51fd\u6570"),(0,l.kt)("p",null,"list:\u6570\u7ec4"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"l\u548cv\u5206\u522b\u8868\u793a\u5217\u8868\u8fd8\u662f\u6570\u7ec4(\u5411\u91cf)\u7684\u65b9\u5f0f\u63d0\u4f9b\u53c2\u6570")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"p\u8868\u793a\u5728\u7528\u6237\u7684==path==\u8def\u5f84\u4e0b\u67e5\u627e\u53ef\u6267\u884c\u6587\u4ef6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"e\u8868\u793a\u4e3a\u65b0\u8fdb\u7a0b\u63d0\u4f9b\u65b0\u7684\u73af\u5883\u53d8\u91cf"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"        #include <unistd.h>\n       extern char **environ;\n       int execl(const char *path, const char *arg, ...\n                       /* (char  *) NULL */); //NULL\u8868\u793a\u5217\u8868\u7ed3\u675f\n       int execlp(const char *file, const char *arg, ...\n                       /* (char  *) NULL */);\n       int execle(const char *path, const char *arg, ...\n                       /*, (char *) NULL, char * const envp[] */);\n       int execv(const char *path, char *const argv[]);\n       int execvp(const char *file, char *const argv[]);\n       int execvpe(const char *file, char *const argv[], char *const envp[]);\n\n")),(0,l.kt)("h4",{id:"exec\u51fd\u6570\u5230\u5e95\u505a\u4e86\u4ec0\u4e48"},"exec\u51fd\u6570\u5230\u5e95\u505a\u4e86\u4ec0\u4e48"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6539\u53d8\u4e86\u5730\u5740\u7a7a\u95f4\u548c\u8fdb\u7a0b\u6620\u50cf"),(0,l.kt)("li",{parentName:"ol"},"\u6302\u8d77\u7684\u6240\u6709\u4fe1\u53f7\u90fd\u4f1a\u53bb\u5931"),(0,l.kt)("li",{parentName:"ol"},"\u540e\u7eed\u6355\u6349\u5230\u7684\u6240\u6709\u4fe1\u53f7\u90fd\u4f1a\u8fd8\u539f\u4e3a\u9ed8\u8ba4\u5904\u7406\u65b9\u5f0f"),(0,l.kt)("li",{parentName:"ol"},"\u4e22\u5f03\u6240\u6709\u5185\u5b58\u9501"),(0,l.kt)("li",{parentName:"ol"},"\u5927\u591a\u6570\u7ebf\u7a0b\u5c5e\u6027\u4f1a\u8fd8\u539f\u4e3a\u9ed8\u8ba4\u503c\uff1a"),(0,l.kt)("li",{parentName:"ol"},"\u91cd\u7f6e\u5927\u591a\u6570\u8fdb\u7a0b\u76f8\u5173\u7684\u7edf\u8ba1\u4fe1\u606f\uff1a"),(0,l.kt)("li",{parentName:"ol"},"\u6e05\u7a7a\u548c\u8fdb\u7a0b\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u76f8\u5173\u7684\u6240\u6709\u6570\u636e\uff0c\u5305\u62ec\u6240\u6709\u6620\u5c04\u7684\u6587\u4ef6\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u6e05\u7a7a\u6240\u6709\u53ea\u5b58\u5728\u4e8e\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\u3002")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u8fdb\u7a0b\u6539\u53d8\u4e3a\u6267\u884c\u7684\u8fdb\u7a0b"),(0,l.kt)("li",{parentName:"ol"},"\u4fe1\u53f7\u63a5\u6536\u9ed8\u8ba4\u5904\u7406\u65b9\u5f0f:\u4e00\u79cd\u662f\u4ec0\u4e48\u4e5f\u4e0d\u505a,\u4e00\u79cd\u662f\u76f4\u63a5\u6740\u6b7b")),(0,l.kt)("h3",{id:"\u8fdb\u7a0b\u7684\u9000\u51fa"},"\u8fdb\u7a0b\u7684\u9000\u51fa"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"#include <stdlib.h>\nvoid exit(intstatus\uff09\uff1b\n")),(0,l.kt)("p",null,"status\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a\u5b8f\u5b9a\u4e49\uff1aEXITSUCCESS\u548cEXITFAILURE\n\u5728\u8fdb\u7a0b\u8c03\u7528exit\u4e4b\u540e\uff0cc\u5e93\u4f1a\u6309\u987a\u5e8f\u5b8c\u6210\u4ee5\u4e0b\u4e8b\u4ef6\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528\u4efb\u4f55\u7531",(0,l.kt)("inlineCode",{parentName:"li"},"atexit()"),"\u6216",(0,l.kt)("inlineCode",{parentName:"li"},"on_exit()"),"\u6ce8\u518c\u7684\u51fd\u6570\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u6e05\u7a7a\u6240\u6709\u5df2\u6253\u5f00\u7684\u6807\u51c6I/O\u6d41\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u5220\u9664\u7531",(0,l.kt)("inlineCode",{parentName:"li"},"tmpfi1e()"),"\u51fd\u6570\u521b\u5efa\u7684\u6240\u6709\u4e34\u65f6\u6587\u4ef6\uff1b")),(0,l.kt)("p",null,"\u5b8c\u6210\u4e0a\u9762\u7684\u64cd\u4f5c\u540e\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"exit()")," \u4f1a\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"exit()"),"\uff0c\u5185\u6838\u63a5\u7ba1\u4e0b\u9762\u7684\u4e8b\uff1a"),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u6e05\u7406\u8fdb\u7a0b\u6240\u521b\u5efa\u7684\u3001\u4e0d\u518d\u4f7f\u7528\u7684\u6240\u6709\u8d44\u6e90\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u9500\u6bc1\u8fdb\u7a0b\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u544a\u77e5\u7236\u8fdb\u7a0b\u5176\u5b50\u8fdb\u7a0b\u5df2\u88ab\u7ec8\u6b62")),(0,l.kt)("h4",{id:"wait--waitpid"},(0,l.kt)("inlineCode",{parentName:"h4"},"wait()")," & ",(0,l.kt)("inlineCode",{parentName:"h4"},"waitpid()")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5b50\u8fdb\u7a0b\u6d3b\u7740\uff0c\u7236\u8fdb\u7a0b\u7ed3\u675f\uff0c\u5219\u5b50\u8fdb\u7a0b\u53d8\u4e3a\u5b64\u513f\u8fdb\u7a0b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5b50\u8fdb\u7a0b\u6b7b\u4e86\uff0c\u4f46\u7236\u8fdb\u7a0b\u4e0d\u4e3a\u5176\u201c\u6536\u6237\u201d\uff08\u91ca\u653e\u8d44\u6e90\uff09\uff0c\u5219\u5b50\u8fdb\u7a0b\u53d8\u4e3a\u50f5\u5c38\u8fdb\u7a0b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5b64\u513f\u8fdb\u7a0b\u53ef\u4ee5\u88ab1\u53f7\u8fdb\u7a0b\u6536\u517b\uff0c\u5bf9\u7cfb\u7edf\u65e0\u5bb3")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u50f5\u5c38\u8fdb\u7a0b\u5df2\u7ecf\u4e0d\u5de5\u4f5c\uff0c\u4f46\u662f\u4f9d\u7136\u5360\u6709\u8d44\u6e90\uff0c\u5bf9\u7cfb\u7edf\u6709\u5bb3\uff0c\u9700\u907f\u514d"))),(0,l.kt)("p",null,"0-255\u6ca1\u6709\u8fd4\u56de-1"),(0,l.kt)("p",null,"_exit:\u5185\u6838\u51fd\u6570"),(0,l.kt)("p",null,"\u8fdb\u7a0b\u6700\u591a:1024\u4e2aid"),(0,l.kt)("p",null,"\u4e00\u822c\u7236\u8fdb\u7a0b\u4e0e\u5b50\u8fdb\u7a0b\u7ec4id\u76f8\u540c"),(0,l.kt)("p",null,"fork()\u51fd\u6570;"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},'//\u5fc5\u987b\u5199    \nif ((pid = fork()) < 0) {\n        perror("fork()");\n        exit(1);\n    }\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"       #include <sys/types.h>\n       #include <sys/wait.h>\n       pid_t wait(int *wstatus);\n       pid_t waitpid(pid_t pid, int *wstatus, int options);\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"wait\u548cwaitpid\u6700\u7ec8\u90fd\u4f1a\u5c06\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u72b6\u6001\u5b58\u653e\u5728status\u5730\u5740\u4e2d")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"waitpid\u4e2d\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570pid\uff0c\u53ef\u4ee5\u6709\u4ee5\u4e0b\u51e0\u4e2a\u503c\uff1a"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"pid<-1\uff1a\u7b49\u5f85\u4e00\u4e2a\u8fdb\u7a0b\u7ec4ID\u4e3apid\u7edd\u5bf9\u503c\u7684\u4efb\u4f55\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0c\u5982\u679cpid=500\uff0c\u5219\u7b49\u5f85\u8fdb\u7a0b\u7ec4ID\u4e3a500\u7684\u4efb\u4f55\u5b50\u8fdb\u7a0b\u9000\u51fa"),(0,l.kt)("li",{parentName:"ol"},"pid=-1\uff1a\u7b49\u5f85\u4efb\u4f55\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0c\u884c\u4e3a\u548c",(0,l.kt)("inlineCode",{parentName:"li"},"wait()"),"\u4e00\u81f4\uff1b"),(0,l.kt)("li",{parentName:"ol"},"pid=0\uff1a\u7b49\u5f85\u540c\u4e00\u4e2a\u8fdb\u7a0b\u7ec4\u4e2d\u7684\u4efb\u4f55\u5b50\u8fdb\u7a0b\u9000\u51fa"),(0,l.kt)("li",{parentName:"ol"},"pid>0\uff1a\u7b49\u5f85\u8fdb\u7a0bpid\u4e3apid\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\u3002"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"option\u53c2\u6570\u4e00\u822c\u9ed8\u8ba4\u4e3a0"))),(0,l.kt)("h2",{id:"\u5b64\u513f\u8fdb\u7a0b"},"\u5b64\u513f\u8fdb\u7a0b"),(0,l.kt)("p",null,"\u4e00\u4e2a\u7236\u8fdb\u7a0b\u9000\u51fa\uff0c\u800c\u5b83\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5b50\u8fdb\u7a0b\u8fd8\u5728\u8fd0\u884c\uff0c\u90a3\u4e48\u8fd9\u4e9b\u5b50\u8fdb\u7a0b\u5c06\u6210\u4e3a\u5b64\u513f\u8fdb\u7a0b\u3002"),(0,l.kt)("p",null,"\u5b64\u513f\u8fdb\u7a0b\u5c06\u88ab init \u8fdb\u7a0b\uff08\u8fdb\u7a0b\u53f7\u4e3a 1\uff09\u6240\u6536\u517b\uff0c\u5e76\u7531 init \u8fdb\u7a0b\u5bf9\u5b83\u4eec\u5b8c\u6210\u72b6\u6001\u6536\u96c6\u5de5\u4f5c\u3002"),(0,l.kt)("p",null,"\u7531\u4e8e\u5b64\u513f\u8fdb\u7a0b\u4f1a\u88ab init \u8fdb\u7a0b\u6536\u517b\uff0c\u6240\u4ee5\u5b64\u513f\u8fdb\u7a0b\u4e0d\u4f1a\u5bf9\u7cfb\u7edf\u9020\u6210\u5371\u5bb3\u3002"),(0,l.kt)("h2",{id:"\u50f5\u5c38\u8fdb\u7a0b"},"\u50f5\u5c38\u8fdb\u7a0b"),(0,l.kt)("p",null,"\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u5728\u5b50\u8fdb\u7a0b\u9000\u51fa\u65f6\u4e0d\u4f1a\u91ca\u653e\uff0c\u53ea\u6709\u5f53\u7236\u8fdb\u7a0b\u901a\u8fc7 wait() \u6216 waitpid()  \u83b7\u53d6\u4e86\u5b50\u8fdb\u7a0b\u4fe1\u606f\u540e\u624d\u4f1a\u91ca\u653e\u3002\u5982\u679c\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0c\u800c\u7236\u8fdb\u7a0b\u5e76\u6ca1\u6709\u8c03\u7528 wait() \u6216  waitpid()\uff0c\u90a3\u4e48\u5b50\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u4ecd\u7136\u4fdd\u5b58\u5728\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u79cd\u8fdb\u7a0b\u79f0\u4e4b\u4e3a\u50f5\u5c38\u8fdb\u7a0b\u3002"),(0,l.kt)("p",null,"\u50f5\u5c38\u8fdb\u7a0b\u901a\u8fc7 ps \u547d\u4ee4\u663e\u793a\u51fa\u6765\u7684\u72b6\u6001\u4e3a Z\uff08zombie\uff09\u3002"),(0,l.kt)("p",null,"\u7cfb\u7edf\u6240\u80fd\u4f7f\u7528\u7684\u8fdb\u7a0b\u53f7\u662f\u6709\u9650\u7684\uff0c\u5982\u679c\u4ea7\u751f\u5927\u91cf\u50f5\u5c38\u8fdb\u7a0b\uff0c\u5c06\u56e0\u4e3a\u6ca1\u6709\u53ef\u7528\u7684\u8fdb\u7a0b\u53f7\u800c\u5bfc\u81f4\u7cfb\u7edf\u4e0d\u80fd\u4ea7\u751f\u65b0\u7684\u8fdb\u7a0b\u3002"),(0,l.kt)("p",null,"\u8981\u6d88\u706d\u7cfb\u7edf\u4e2d\u5927\u91cf\u7684\u50f5\u5c38\u8fdb\u7a0b\uff0c\u53ea\u9700\u8981\u5c06\u5176\u7236\u8fdb\u7a0b\u6740\u6b7b\uff0c\u6b64\u65f6\u50f5\u5c38\u8fdb\u7a0b\u5c31\u4f1a\u53d8\u6210\u5b64\u513f\u8fdb\u7a0b\uff0c\u4ece\u800c\u88ab init \u8fdb\u7a0b\u6240\u6536\u517b\uff0c\u8fd9\u6837 init \u8fdb\u7a0b\u5c31\u4f1a\u91ca\u653e\u6240\u6709\u7684\u50f5\u5c38\u8fdb\u7a0b\u6240\u5360\u6709\u7684\u8d44\u6e90\uff0c\u4ece\u800c\u7ed3\u675f\u50f5\u5c38\u8fdb\u7a0b\u3002"),(0,l.kt)("h3",{id:"git\u8fdb\u7a0b\u7684\u534f\u540c\u8c03\u7528"},"git\u8fdb\u7a0b\u7684\u534f\u540c\u8c03\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},'#include "head.h" \n#define filename "temp"\n\nint m_flag = 0;\nint main(int argc, char **argv) {\n    int opt;\n    pid_t pid;\n    char *msg = NULL;\n    while ((opt = getopt(argc, argv, "m:")) != -1) {\n        switch (opt) {\n            case \'m\':\n                m_flag = 1;\n                msg = strdup(optarg);\n                break;\n            default:\n                fprintf(stderr,"Usage: %s [-m message]\\n", argv[0]);\n                exit(1);\n        }\n    }\n    if (m_flag) {\n        if (msg) {\n            printf("%s\\n", msg);\n            free(msg);\n        }\n        return 0;\n    }\n    \n    if ((pid = fork()) < 0) {\n        perror("fork error");\n        exit(1);\n    }\n    if (pid == 0) {\n        execlp("vim", "vim", filename, NULL);\n    } else {\n            wait(NULL);\n            if (access(filename, R_OK) != 0) {\n                perror("access error");\n                exit(1);\n            }\n            if((pid = fork()) < 0) {\n                perror("fork error");\n                exit(1);\n            }\n            if (pid == 0) {\n                //printf("cat!\\n");\n                execlp("cat", "cat", filename, NULL);\n            } else {\n                wait(NULL);\n                //printf("rm\\n");\n                execlp("rm", "rm", filename, NULL);\n            }\n    }\n    return 0;\n}\n\n')),(0,l.kt)("h1",{id:"\u8fdb\u7a0b\u7ba1\u7406"},"\u8fdb\u7a0b\u7ba1\u7406"),(0,l.kt)("h3",{id:"\u8fdb\u7a0b\u8c03\u5ea6"},"\u8fdb\u7a0b\u8c03\u5ea6"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u8c03\u5ea6\u662f\u4e00\u4e2a\u5185\u6838\u5b50\u7cfb\u7edf"),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u8c03\u5ea6\u7684\u4e3b\u8981\u4efb\u52a1\u662f\u51b3\u5b9a\u54ea\u4e00\u4e2a\u201d\u5c31\u7eea\u201d\u72b6\u6001\u7684\u8fdb\u7a0b\u6765\u6267\u884c\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u5c31\u7eea\u8fdb\u7a0b\u662f\u975e\u963b\u585e\u8fdb\u7a0b\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u963b\u585e\u8fdb\u7a0b\u5c31\u662f\u6b63\u5728\u7761\u7720\u7684\u8fdb\u7a0b\uff0c\u9700\u8981\u5185\u6838\u5524\u9192\u7684\u8fdb\u7a0b\uff1b")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20200806183724200",src:t(12070).Z})),(0,l.kt)("p",null,"\u5c31\u7eea:\u5df2\u7ecf\u83b7\u5f97\u8d44\u6e90"),(0,l.kt)("h3",{id:"\u534f\u540c\u5f0f\u548c\u62a2\u5360\u5f0f"},"\u534f\u540c\u5f0f\u548c\u62a2\u5360\u5f0f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u534f\u540c\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u4f1a\u4e00\u76f4\u8fd0\u884c\u76f4\u5230\u5b83\u81ea\u5df1\u7ed3\u675f\u3002\uff08\u8ba9\u51fayielding\uff09"),(0,l.kt)("li",{parentName:"ul"},"\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u505a\u4efb\u4f55\u5e72\u9884"))),(0,l.kt)("li",{parentName:"ul"},"\u62a2\u5360\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\u5668\u51b3\u5b9a\u8fdb\u7a0b\u4f55\u65f6\u7ed3\u675f\u5e76\u6267\u884c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u53eb\u505a\u62a2\u5360\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u88ab\u62a2\u5360\u524d\u8fd0\u884c\u7684\u65f6\u95f4\u79f0\u4e3a\u8be5\u8fdb\u7a0b\u7684\u65f6\u540c\u7247\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\u5668\u7ed9\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u4e00\u4e2a\u5904\u7406\u5668\u65f6\u540c\u7247\u3002")))),(0,l.kt)("h3",{id:"\u65f6\u95f4\u7247"},"\u65f6\u95f4\u7247"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u65f6\u95f4\u7247\u7684\u957f\u77ed\u4f1a\u5bf9\u4e8e\u7cfb\u7edf\u7684\u5168\u5c40\u884c\u4e3a\u548c\u6027\u80fd\u6765\u8bf4\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u65f6\u95f4\u7247\u8fc7\u957f\uff1a-\u300b\u63d0\u5347\u7cfb\u7edf\u901a\u5410\u7387\u548c\u5168\u5c40\u6027\u80fd"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u6267\u884c\u524d\u9700\u8981\u7b49\u5f85\u5f88\u957f\u65f6\u95f4\uff0c\u964d\u4f4e\u4e86\u5e76\u53d1\u8fd0\u884c"),(0,l.kt)("li",{parentName:"ul"},"\u7528\u6237\u4f1a\u611f\u5230\u660e\u663e\u7684\u5ef6\u8fdf"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u65f6\u95f4\u7247\u8fc7\u77ed\uff1a-\u300b\u63d0\u5347\u4ea4\u4e92\u6027\u80fd"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5927\u91cf\u7684\u65f6\u95f4\u5c06\u82b1\u8d39\u5728\u8c03\u5ea6\u4e0a")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u65f6\u95f4\u5c40\u90e8\u6027\u5e26\u6765\u7684\u6027\u80fd\u63d0\u5347\u5c06\u5927\u6253\u6298\u6263")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u89e3\u51b3\u65f6\u95f4\u7247\u957f\u77ed\u95ee\u9898\uff1a\u4e0d\u7528\u65f6\u95f4\u7247"))),(0,l.kt)("p",null,"\u865a\u62df\u5185\u5b58:"),(0,l.kt)("p",null,"==\u5199\u62f7\u8d1d==:"),(0,l.kt)("p",null,"\u5e76\u53d1:\u4e00\u6bb5\u65f6\u95f4\u5185,\u90fd\u6267\u884c;"),(0,l.kt)("p",null,"\u5e76\u884c:\u771f\u6b63\u7684\u540c\u65f6\u6267\u884c;"),(0,l.kt)("p",null,"\u8c03\u5ea6:\u8fd0\u884c\u90a3\u4e2a\u8fdb\u7a0b,\u8fd0\u884c\u591a\u4e45"),(0,l.kt)("p",null,"\u540c\u6b65:\u6709\u5148\u6709\u540e\u7684\u6267\u884c,\u987a\u5e8f\u786e\u5b9a;"),(0,l.kt)("p",null,"cpu->cpu\u5bc4\u5b58\u5668->cache(3\u7ea7\u7f13\u5b58)->\u5185\u5b58->\u5916\u5b58"),(0,l.kt)("h2",{id:"\u521b\u5efa\u591a\u4e2a\u5b50\u8fdb\u7a0b"},"\u521b\u5efa\u591a\u4e2a\u5b50\u8fdb\u7a0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},'#include "head.h" \n\nint main(int argc, char **argv) {\n    pid_t pid;\n    int x = 0;\n    for (int i = 0; i < 100; ++i) {\n        if ((pid = fork()) < 0) {\n            perror("fork()");\n            exit(1);\n        }\n        x = i;\n        if (pid == 0) break;\n    } \n    if (pid == 0) {\n        DBG(GREEN"<Debug>"NONE "\u6211\u662f\u7b2c %d \u4e2a\u5b69\u5b50\\n", x);\n    } else {\n        for (int i = 0; i < x; ++i) {\n            wait(NULL);\n        }\n    }\n\n    return 0;\n}\n\n')),(0,l.kt)("h2",{id:"\u901a\u8fc7\u6587\u4ef6\u9501\u5199\u5165\u6587\u4ef6\uff0c\u591a\u8fdb\u7a0b\u7d2f\u52a0"},"\u901a\u8fc7\u6587\u4ef6\u9501\u5199\u5165\u6587\u4ef6\uff0c\u591a\u8fdb\u7a0b\u7d2f\u52a0"),(0,l.kt)("h3",{id:"1struct\u7ed3\u6784\u4f53"},"1.struct\u7ed3\u6784\u4f53"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},'#include "head.h"\n\nstruct Num {\n    int now, sum;\n};\n\nchar num_file[] = "./.num";\nchar lock_file[] = "./.lock";\n\nsize_t set_num(struct Num *num) {\n    FILE *fp = fopen(num_file, "w");\n    size_t nwrite = fwrite(num, sizeof(struct Num), 1, fp);\n    fclose(fp);\n    return nwrite;\n} \n\nsize_t get_num(struct Num *num) {\n    FILE *fp = fopen(num_file, "r");\n    if (fp == NULL) {\n        perror("fopen_r()");\n        return -1;\n    }\n    size_t nread = fread(num, sizeof(struct Num), 1,  fp);\n    fclose(fp);\n    if (nread < 0) {\n        return -1;\n    }\n    return nread;\n}\n\nvoid do_add(int max, int x) {\n    struct Num num;\n    while (1) {\n        FILE *lock = fopen(lock_file, "w");\n        flock(lock->_fileno, LOCK_EX);\n        if (get_num(&num) < 0) {\n            fclose(lock);\n            continue; \n        }\n        DBG(GREEN"<Debug>"NONE " : <%d> now = %d, sum = %d\\n", x, num.now, num.sum);\n        if (num.now > max) {\n            flock(lock->_fileno, LOCK_UN);\n            break;\n        }\n        \n        num.sum += num.now;\n        num.now++;\n        set_num(&num);\n        flock(lock->_fileno, LOCK_UN);\n    }\n    return ;\n}\n\nint main(int argc, char ** argv) {\n    if (argc != 3) {\n        fprintf(stderr, "Usage : %s max ins\\n", argv[0]);\n        exit(1);\n    }\n    int max = atoi(argv[1]);\n    int ins = atoi(argv[2]);\n    struct Num num;\n    num.now = 0;\n    num.sum = 0;\n\n    //save to File\n    set_num(&num);\n\n    pid_t pid;\n    int x;\n    for (int i = 0; i < ins; ++i) {\n        if ((pid = fork()) < 0) {\n            perror("fork()");\n            exit(1);\n        }\n        x = i;\n        if (pid == 0) break;\n    }\n        \n    if (pid == 0) {\n        //do add\n        do_add(max, x);\n        exit(0);\n    }\n    \n    for (int i = 0; i < ins; ++i) {\n        wait(NULL);\n    }\n    \n    // read from File\n    get_num(&num);\n    printf("sum = %d\\n", num.sum);\n    return 0;\n}\n\n')),(0,l.kt)("h3",{id:"2\u53d8\u91cf"},"2.\u53d8\u91cf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},'#include "head.h"\n\nchar num_file[] = "./.num";\nchar lock_file[] = "./.lock";\n\nsize_t set_num(int now, int sum) {\n    FILE *fp = fopen(num_file, "w");\n    char buffer[100] = {0};\n    sprintf(buffer,"%d\\n%d\\n", now, sum);\n    size_t nwrite = fwrite(buffer, strlen(buffer), 1, fp);\n    fclose(fp);\n    return nwrite;\n} \n\nsize_t get_num(int *now, int *sum) {\n    FILE *fp = fopen(num_file, "r");\n    if (fp == NULL) {\n        perror("fopen_r()");\n        return -1;\n    }\n\n    char tmp_now[20] = {0};\n    char tmp_sum[20] = {0};\n    fgets(tmp_now, sizeof(tmp_now), fp);\n    fgets(tmp_sum, sizeof(tmp_sum), fp);\n    tmp_now[strlen(tmp_now) - 1] = \'\\0\';\n    tmp_sum[strlen(tmp_sum) - 1] = \'\\0\';\n    *now = atoi(tmp_now);\n    *sum = atoi(tmp_sum);\n    fclose(fp);\n    return 0;\n}\n\nvoid do_add(int max, int x) {\n    int sum = 0, now = 0;\n    while (1) {\n        FILE *lock = fopen(lock_file, "w");\n        flock(lock->_fileno, LOCK_EX);\n        if (get_num(&now, &sum) < 0) {\n            fclose(lock);\n            continue; \n        }\n        DBG(GREEN"<Debug>"NONE " : <%d> now = %d, sum = %d\\n", x, now, sum);\n        if (now > max) {\n            flock(lock->_fileno, LOCK_UN);\n            break;\n        }\n        \n        sum += now;\n        now++;\n        set_num(now, sum);\n        flock(lock->_fileno, LOCK_UN);\n    }\n    return ;\n}\n\nint main(int argc, char ** argv) {\n    if (argc != 3) {\n        fprintf(stderr, "Usage : %s max ins\\n", argv[0]);\n        exit(1);\n    }\n    //atoi\u8f6c\u8bd1 str \u6240\u6307\u7684\u5b57\u8282\u5b57\u7b26\u4e32\u4e2d\u7684\u6574\u6570\u503c\n    int max = atoi(argv[1]);\n    int ins = atoi(argv[2]);\n    int now = 0;\n    int sum = 0;\n\n    //save to File\n    set_num(now, sum);\n\n    pid_t pid;\n    int x;\n    for (int i = 0; i < ins; ++i) {\n        if ((pid = fork()) < 0) {\n            perror("fork()");\n            exit(1);\n        }\n        x = i;\n        if (pid == 0) break;\n    }\n        \n    if (pid == 0) {\n        //do add\n        do_add(max, x);\n        exit(0);\n    }\n    \n    for (int i = 0; i < ins; ++i) {\n        wait(NULL);\n    }\n    \n    // read from File\n    get_num(&now, &sum);\n    printf("sum = %d\\n", sum);\n    return 0;\n}\n\n')))}c.isMDXComponent=!0},12070:function(n,e,t){"use strict";e.Z=t.p+"assets/images/image-20200806183724200-5f9123d5c012d12ab430333c97cb214d.png"}}]);