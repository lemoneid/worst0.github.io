<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Wiki Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">C1.ç½‘ç»œAPI | My Wiki</title><meta data-react-helmet="true" property="og:url" content="https://worst0.github.io/Server/C1.ç½‘ç»œAPI"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="C1.ç½‘ç»œAPI | My Wiki"><meta data-react-helmet="true" name="description" content="Linuxç½‘ç»œç¼–ç¨‹åŸºç¡€API"><meta data-react-helmet="true" property="og:description" content="Linuxç½‘ç»œç¼–ç¨‹åŸºç¡€API"><meta data-react-helmet="true" property="og:image" content="https://cos.ap-guangzhou.myqcloud.com/wiki-media-1253965369/doc/logo-zip.png"><meta data-react-helmet="true" name="twitter:image" content="https://cos.ap-guangzhou.myqcloud.com/wiki-media-1253965369/doc/logo-zip.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://worst0.github.io/Server/C1.ç½‘ç»œAPI"><link data-react-helmet="true" rel="alternate" href="https://worst0.github.io/Server/C1.ç½‘ç»œAPI" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://worst0.github.io/Server/C1.ç½‘ç»œAPI" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.060912d8.css">
<link rel="preload" href="/assets/js/runtime~main.8bd170ed.js" as="script">
<link rel="preload" href="/assets/js/main.30834e93.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Wiki</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/intro">DocumentğŸ’»</a><a class="navbar__item navbar__link" href="/blog">BlogğŸ¤“</a><a class="navbar__item navbar__link" href="/ReadingNotes/A1.Sentence">Reading-BookğŸ“š</a><a class="navbar__item navbar__link" href="/Xmind_IMG/1.è§£é¢˜æ€ç»´">XmindğŸ®</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/worst0/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://github.com/worst0/wiki_note" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">æœ¬ç«™æºç </a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">ğŸŒ™</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Wiki</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/intro">DocumentğŸ’»</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">BlogğŸ¤“</a></li><li class="menu__list-item"><a class="menu__link" href="/ReadingNotes/A1.Sentence">Reading-BookğŸ“š</a></li><li class="menu__list-item"><a class="menu__link" href="/Xmind_IMG/1.è§£é¢˜æ€ç»´">XmindğŸ®</a></li><li class="menu__list-item"><a href="https://github.com/worst0/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://github.com/worst0/wiki_note" target="_blank" rel="noopener noreferrer" class="menu__link">æœ¬ç«™æºç </a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">intro</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/intro">Readme</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">1.Linux</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Linux å‘½ä»¤</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/A1.linuxåŸºç¡€">A1.linuxåŸºç¡€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/A2.Linuxå‘½ä»¤">A2.Linuxå‘½ä»¤</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/A3.ç¼–è¯‘ç¯å¢ƒ">A3.ç¼–è¯‘ç¯å¢ƒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/A4.æ•°æ®æå–">æ•°æ®æå–</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/A5.Linuxå‘½ä»¤è¡¥å……">Linuxå‘½ä»¤</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">shellè„šæœ¬</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/B1.shellè„šæœ¬è¯­æ³•">shellè„šæœ¬è¯­æ³•</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ubuntu</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/C1.ubuntuç›¸å…³">C1.ubuntuç›¸å…³</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/C2.ubuntuå¸¸ç”¨è½¯ä»¶">ubuntuå¸¸ç”¨è½¯ä»¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Linux/C3.è¯­è¨€ç¯å¢ƒ">è¯­è¨€ç¯å¢ƒ</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">2.Algorithm</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">æ•°æ®ç»“æ„</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A1.DataStructure">æ•°æ®ç»“æ„å’Œç®—æ³•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A2.æ•°ç»„å’Œé“¾è¡¨">æ•°ç»„å’Œé“¾è¡¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A3.æ ˆå’Œé˜Ÿåˆ—">æ ˆ,é˜Ÿåˆ—</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A4.å †å’Œä¼˜å…ˆé˜Ÿåˆ—">å †å’Œä¼˜å…ˆé˜Ÿåˆ—</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A5.å“ˆå¤«æ›¼æ ‘">å“ˆå¼—æ›¼æ ‘ä¸å“ˆå¼—æ›¼ç¼–ç </a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A6.å“ˆå¸Œè¡¨">å“ˆå¸Œè¡¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A7.æ’åº">æ’åº</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A7.æ ‘">æ ‘</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A8.å­—ç¬¦ä¸²åŒ¹é…">å­—ç¬¦ä¸²åŒ¹é…</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A10.å­—å…¸æ ‘">å­—å…¸æ ‘</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A10.æ ‘çŠ¶æ•°ç»„å’Œçº¿æ®µæ ‘">æ ‘çŠ¶æ•°ç»„å’Œçº¿æ®µæ ‘</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A11.å¹³è¡¡æ ‘">å¹³è¡¡æ ‘</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A11.å¹¶æŸ¥é›†">å¹¶æŸ¥é›†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A12.å›¾è®º">å›¾è®º</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A15.ä½å›¾å’Œè·³è¡¨">ä½å›¾å’Œè·³è¡¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/A99.å®ç°ADT">å®ç°ADT</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ç®—æ³•è®¾è®¡</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B1.ç®—æ³•åˆ†æ">ç®—æ³•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B10.æ•°è®º">æ•°è®º</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B11.ä½è¿ç®—">ä½è¿ç®—</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B12.è®¡ç®—å‡ ä½•">è®¡ç®—å‡ ä½•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B13.ç½‘ç»œæµ">ç½‘ç»œæµ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B2.è´ªå¿ƒ">è´ªå¿ƒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B3.é€’æ¨åˆ°é€’å½’">é€’æ¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B4.åŠ¨æ€è§„åˆ’">==åŠ¨æ€è§„åˆ’==</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B5.åˆ†æ²»">åˆ†è€Œæ²»ä¹‹ï¼ˆdivide-and-conquerï¼‰</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B6.å‡æ²»å’ŒåŒæŒ‡é’ˆ">B6.å‡æ²»å’ŒåŒæŒ‡é’ˆ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B7.å›æº¯">å›æº¯æ³•ï¼ˆbacktrackingï¼‰</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B8.æœç´¢">B8.æœç´¢</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B9.æ•°å­¦">æ•°å­¦</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B98.å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/B99.ä¸“é¢˜">ä¸“é¢˜</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/C1.Algorithm">ç®—æ³•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/C1.ç®—æ³•æŠ€å·§">ç®—æ³•æŠ€å·§</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/C2.ç¼–ç¨‹ç ç‘">ç¼–ç¨‹ç ç‘</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Think</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/D1.ACMæ¨¡æ¿">ACMæ¨¡æ¿</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/E1.concrete">concrete</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/E2.Combinatorics">ç»„åˆæ•°å­¦</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/G1.é€»è¾‘æ€è€ƒ">é€»è¾‘æ€è€ƒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Algorithm/H1.ç®—æ³•è°œé¢˜">ç®—æ³•è°œé¢˜</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">3.Online_Judge</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Online_Judge/A1.Leetcode">Leetcode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Online_Judge/B1.HZOJ">HZOJ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Online_Judge/C1.nowcoder">Nowcoder</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Online_Judge/D1.EP">æ¬§æ‹‰EP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Online_Judge/E1.ç¼–ç¨‹æŠ€å·§">ç¼–ç¨‹æŠ€å·§</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">4.Programming_Language</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">C</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/A1.CBasic">Cè¯­è¨€åŸºç¡€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/A2.Cimprove">Cè¯­è¨€è¿›é˜¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/A3.Cè¯­è¨€æŠ€å·§">Cè¯­è¨€æŠ€å·§</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">C++</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/B1.C++-basic">C++åŸºç¡€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/B2.C++-improve">C++è¿›é˜¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/B3.C++-exercise">C++-exercise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/B4.C++-others">C++ othres</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/B5.C++ç¼–è¯‘">C++ç¼–è¯‘</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/B6.C++-question">C++-question</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">STL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/C1.STL">STL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/C2.STL-question">STL-question</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">python</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/D1.python">python</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Language/E1.conda">condaå‘½ä»¤</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">5.Programming_Stardard</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Stardard/A1.Cç¼–ç¨‹è§„èŒƒ">Cç¼–ç¨‹è§„èŒƒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Stardard/B1.ç¼–ç è‹±æ–‡ç¼©å†™">ç¼–ç è‹±æ–‡ç¼©å†™</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Stardard/B1.è®¡ç®—æœºå“²å­¦">B1.è®¡ç®—æœºå“²å­¦</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Stardard/B2.è‹±æ–‡æ ‡å‡†ç¼©å†™">è‹±æ–‡æ ‡å‡†ç¼©å†™</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Stardard/C1.é‡æ„">é‡æ„</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Programming_Stardard/D1.Design_Pattern">Design Pattern</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">6.Operating_system</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A1.os">OS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A2.OSæ¦‚è¿°">OSæ¦‚è¿°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A2.æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A3.è¿›ç¨‹ä¸çº¿ç¨‹">è¿›ç¨‹ç®¡ç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A4.æ­»é”">æ­»é”</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A5.å­˜å‚¨ç®¡ç†">å­˜å‚¨ç®¡ç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A6.è®¾å¤‡ç®¡ç†">è®¾å¤‡ç®¡ç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A7.æ–‡ä»¶ç³»ç»Ÿ">æ–‡ä»¶ç³»ç»Ÿ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A8.è¾“å…¥è¾“å‡º">è¾“å…¥è¾“å‡º</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A9.ç¼–è¯‘ç³»ç»Ÿ">ç¼–è¯‘ç³»ç»Ÿ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/C1.è®¡ç®—æœºåŸç†">è®¡ç®—æœºåŸç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/D1.CSAPP">CSAPP</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ç³»ç»Ÿç¼–ç¨‹</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Operating_system/A1.os">OS</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">7.Network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A2.ç½‘ç»œæ¦‚è®º">ç½‘ç»œæ¦‚è®º</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A3.ç‰©ç†å±‚">ç‰©ç†å±‚</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A4.é“¾è·¯å±‚">é“¾è·¯å±‚</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A5.ç½‘ç»œå±‚">ç½‘ç»œå±‚</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A6.ä¼ è¾“å±‚">ä¼ è¾“å±‚</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A7.åº”ç”¨å±‚">åº”ç”¨å±‚</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/A9.ç–‘é—®">ç–‘é—®</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Network/B1.HTTP">HTTP</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">8.Server</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/A1.Linuxé«˜æ€§èƒ½æœåŠ¡å™¨">Linuxé«˜æ€§èƒ½æœåŠ¡å™¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/B1.Linuxå¤šçº¿ç¨‹muduo">C++å¤šçº¿ç¨‹ç³»ç»Ÿç¼–ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/B1.ç³»ç»Ÿç¼–ç¨‹">ç³»ç»Ÿç¼–ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/B2.æ–‡ä»¶IO">æ–‡ä»¶IO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/B3.æ–‡ä»¶å’Œç›®å½•">æ–‡ä»¶å’Œç›®å½•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/B4.æ ‡å‡†IOåº“">æ ‡å‡†IOåº“</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/B9.å‘½ä»¤">B9.å‘½ä»¤</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Server/C1.ç½‘ç»œAPI">C1.ç½‘ç»œAPI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C1.ç½‘ç»œç¼–ç¨‹">C1.ç½‘ç»œç¼–ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C2.é«˜çº§IOå‡½æ•°">C2.é«˜çº§IOå‡½æ•°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C3.ç¨‹åºè§„èŒƒ">C3.ç¨‹åºè§„èŒƒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C4.IOå¤ç”¨">C4.IOå¤ç”¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C5.ä¿¡å·">C5.ä¿¡å·</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C6.å®šæ—¶å™¨">C6.å®šæ—¶å™¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C7.é«˜æ€§èƒ½æœåŠ¡å™¨æ¡†æ¶">C7.é«˜æ€§èƒ½æœåŠ¡å™¨æ¡†æ¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C8.socket">ç½‘ç»œç¼–ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/C9.å®ç°">C9.å®ç°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/D1.å¤šè¿›ç¨‹ç¼–ç¨‹">D1.å¤šè¿›ç¨‹ç¼–ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/D2.è¿›ç¨‹">è¿›ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/D4.è¿›ç¨‹é—´é€šä¿¡">IPCï¼šè¿›ç¨‹é—´é€šä¿¡</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/E1.å¤šçº¿ç¨‹ç¼–ç¨‹">E1.å¤šçº¿ç¨‹ç¼–ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/E2.çº¿ç¨‹">çº¿ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Server/H1.ç½‘ç»œå·¥å…·">H1.ç½‘ç»œå·¥å…·</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">9.Database</a><ul class="menu__list"></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">10.Skill</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Skill/A1.Latexæ•°å­¦å…¬å¼">A1.Latexæ•°å­¦å…¬å¼</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Skill/B1.Markdownè¯­æ³•">Markdownè¯­æ³•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Skill/C1.git">Git</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Skill/C2.github">GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Skill/D1.è®¡ç®—æœºè‹±è¯­">è®¡ç®—æœºè‹±è¯­</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Skill/E1.ç»˜å›¾">ç»˜å›¾</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">11.Interview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Interview/A1.é¢è¯•">A1.é¢è¯•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Interview/A2.interview">interview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Interview/C1.ç®€å†">ç®€å†</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">13.Project</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Project/A1.Gtestæµ‹è¯•æ¡†æ¶">A1.Gtestæµ‹è¯•æ¡†æ¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Project/A2.udp-football">A2.udp-football</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">14.Science</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Science/E3.æ•°å­¦è®¤è¯†">æ•°å­¦è®¤è¯†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Science/F1.ç‰©ç†è®¤è¯†">ç‰©ç†è®¤è¯†</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">99.other</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/other/A1.ä¸´æ—¶">ä¸´æ—¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/other/B1.ä¸´æ—¶ç¬”è®°">ä¸´æ—¶ç¬”è®°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/other/C1.task">task</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/other/D1.è½¯ä»¶éœ€æ±‚">è½¯ä»¶éœ€æ±‚</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/other/E1.software">E1.software</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">C1.ç½‘ç»œAPI</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="linuxç½‘ç»œç¼–ç¨‹åŸºç¡€api"></a>Linuxç½‘ç»œç¼–ç¨‹åŸºç¡€API<a class="hash-link" href="#linuxç½‘ç»œç¼–ç¨‹åŸºç¡€api" title="Direct link to heading">#</a></h2><p>socketåœ°å€APIã€‚socketæœ€å¼€å§‹çš„å«ä¹‰æ˜¯ä¸€ä¸ªIPåœ°å€å’Œç«¯å£å¯¹ï¼ˆipï¼Œportï¼‰</p><p>socketåŸºç¡€APIã€‚socketçš„ä¸»è¦APIéƒ½å®šä¹‰åœ¨sys/socket.hå¤´æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬åˆ›å»ºsocketã€å‘½åsocketã€ç›‘å¬socketã€æ¥å—è¿æ¥ã€å‘èµ·è¿æ¥ã€è¯»å†™æ•°æ®ã€è·å–åœ°å€ä¿¡æ¯ã€æ£€æµ‹å¸¦å¤–æ ‡è®°ï¼Œä»¥åŠè¯»å–å’Œè®¾ç½®socketé€‰é¡¹ã€‚</p><p>ç½‘ç»œä¿¡æ¯APIã€‚Linuxæä¾›äº†ä¸€å¥—ç½‘ç»œä¿¡æ¯APIï¼Œä»¥å®ç°ä¸»æœºåå’ŒIPåœ°å€ä¹‹é—´çš„è½¬æ¢ï¼Œä»¥åŠæœåŠ¡åç§°å’Œç«¯å£å·ä¹‹é—´çš„è½¬æ¢ã€‚è¿™äº›APIéƒ½å®šä¹‰åœ¨netdb.hå¤´æ–‡ä»¶ä¸­</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="socketåœ°å€api"></a>socketåœ°å€API<a class="hash-link" href="#socketåœ°å€api" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åº"></a>ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åº<a class="hash-link" href="#ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åº" title="Direct link to heading">#</a></h4><p>ç°ä»£CPUçš„ç´¯åŠ å™¨ä¸€æ¬¡éƒ½èƒ½è£…è½½ï¼ˆè‡³å°‘ï¼‰4å­—èŠ‚ï¼ˆ32ä½è®¡ç®—æœºï¼‰ï¼Œå³ä¸€ä¸ªæ•´æ•°ã€‚é‚£ä¹ˆè¿™4å­—èŠ‚åœ¨å†…å­˜ä¸­æ’åˆ—çš„é¡ºåºå°†å½±å“å®ƒè¢«ç´¯åŠ å™¨è£…è½½æˆçš„æ•´æ•°çš„å€¼ã€‚è¿™å°±æ˜¯å­—èŠ‚åºé—®é¢˜ã€‚</p><p>å­—èŠ‚åºåˆ†ä¸ºå¤§ç«¯å­—èŠ‚åºï¼ˆbig endianï¼‰å’Œå°ç«¯å­—èŠ‚åºï¼ˆlittle endianï¼‰ã€‚å¤§ç«¯å­—èŠ‚åºæ˜¯æŒ‡ä¸€ä¸ªæ•´æ•°çš„é«˜ä½å­—èŠ‚ï¼ˆ23ï½31 bitï¼‰å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ï¼Œä½ä½å­—èŠ‚ï¼ˆ0ï½7 bitï¼‰å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ã€‚å°ç«¯å­—èŠ‚åºåˆ™æ˜¯æŒ‡æ•´æ•°çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ï¼Œè€Œä½ä½å­—èŠ‚åˆ™å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x12345678</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cout </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å¤§ç«¯&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å°ç«¯&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> endl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> union_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">short</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> byteOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    byteOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">value </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x0102</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">byteOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">union_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">byteOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">union_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;big endian\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">byteOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">union_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">byteOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">union_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;little endian\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;unknown...\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ç°ä»£PCå¤§å¤šé‡‡ç”¨å°ç«¯å­—èŠ‚åºï¼Œå› æ­¤å°ç«¯å­—èŠ‚åºåˆè¢«ç§°ä¸ºä¸»æœºå­—èŠ‚åºã€‚</p><p>å¤§ç«¯å­—èŠ‚åºä¹Ÿç§°ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œå®ƒç»™æ‰€æœ‰æ¥æ”¶æ•°æ®çš„ä¸»æœºæä¾›äº†ä¸€ä¸ªæ­£ç¡®è§£é‡Šæ”¶åˆ°çš„æ ¼å¼åŒ–æ•°æ®çš„ä¿è¯ã€‚</p><p>å³ä½¿æ˜¯åŒä¸€å°æœºå™¨ä¸Šçš„ä¸¤ä¸ªè¿›ç¨‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”±Cè¯­è¨€ç¼–å†™ï¼Œå¦ä¸€ä¸ªç”±JAVAç¼–å†™ï¼‰é€šä¿¡ï¼Œä¹Ÿè¦è€ƒè™‘å­—èŠ‚åºçš„é—®é¢˜</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;netinet/in.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//htonlè¡¨ç¤ºâ€œhost to network longâ€</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å³å°†é•¿æ•´å‹ï¼ˆ32 bitï¼‰çš„ä¸»æœºå­—èŠ‚åºæ•°æ®è½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚åºæ•°æ®ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//è¿™4ä¸ªå‡½æ•°ä¸­ï¼Œé•¿æ•´å‹å‡½æ•°é€šå¸¸ç”¨æ¥è½¬æ¢IPåœ°å€ï¼ŒçŸ­æ•´å‹å‡½æ•°ç”¨æ¥è½¬æ¢ç«¯å£å·</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">htonl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> hostlong</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> hostshort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ntohl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> netlong</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ntohs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> netshort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é€šç”¨socketåœ°å€"></a>é€šç”¨socketåœ°å€<a class="hash-link" href="#é€šç”¨socketåœ°å€" title="Direct link to heading">#</a></h4><p>socketç½‘ç»œç¼–ç¨‹æ¥å£ä¸­è¡¨ç¤ºsocketåœ°å€çš„æ˜¯ç»“æ„ä½“sockaddr</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;bits/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sa_family_t sa_family</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> sa_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">14</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sa_familyæˆå‘˜æ˜¯åœ°å€æ—ç±»å‹ï¼ˆsa_family_tï¼‰çš„å˜é‡ã€‚åœ°å€æ—ç±»å‹é€šå¸¸ä¸åè®®æ—ç±»å‹å¯¹åº”ã€‚å¸¸è§çš„åè®®æ—ï¼ˆprotocol familyï¼Œä¹Ÿç§°domainï¼‰å’Œå¯¹åº”çš„åœ°å€æ—</p><p><img alt="image-20210908172043518" src="/assets/images/image-20210908172043518-5cf5e28982afb8da206214781ede4c76.png"></p><p>å®<code>PF_*</code>å’Œ<code>AF_*</code>éƒ½å®šä¹‰åœ¨bits/socket.hå¤´æ–‡ä»¶ä¸­ï¼Œä¸”åè€…ä¸å‰è€…æœ‰å®Œå…¨ç›¸åŒçš„å€¼ï¼Œæ‰€ä»¥äºŒè€…é€šå¸¸æ··ç”¨ã€‚</p><p>sa_dataæˆå‘˜ç”¨äºå­˜æ”¾socketåœ°å€å€¼ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„åè®®æ—çš„åœ°å€å€¼å…·æœ‰ä¸åŒçš„å«ä¹‰å’Œé•¿åº¦ï¼Œ</p><p><img alt="image-20210908172125879" src="/assets/images/image-20210908172125879-a9ed973c5eab83422d094110cfbc6c66.png"></p><p>14å­—èŠ‚çš„sa_dataæ ¹æœ¬æ— æ³•å®Œå…¨å®¹çº³å¤šæ•°åè®®æ—çš„åœ°å€å€¼ã€‚å› æ­¤ï¼ŒLinuxå®šä¹‰äº†ä¸‹é¢è¿™ä¸ªæ–°çš„é€šç”¨socketåœ°å€ç»“æ„ä½“ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;bits/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_storage</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sa_family_t sa_family</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> int__ss_align</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">char__ss_padding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">128</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__ss_align</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>è¿™ä¸ªç»“æ„ä½“ä¸ä»…æä¾›äº†è¶³å¤Ÿå¤§çš„ç©ºé—´ç”¨äºå­˜æ”¾åœ°å€å€¼ï¼Œè€Œä¸”æ˜¯å†…å­˜å¯¹é½çš„ï¼ˆè¿™æ˜¯__ss_alignæˆå‘˜çš„ä½œç”¨ï¼‰ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä¸“ç”¨socketåœ°å€"></a>ä¸“ç”¨socketåœ°å€<a class="hash-link" href="#ä¸“ç”¨socketåœ°å€" title="Direct link to heading">#</a></h4><p>UNIXæœ¬åœ°åŸŸåè®®æ—ä½¿ç”¨å¦‚ä¸‹ä¸“ç”¨socketåœ°å€ç»“æ„ä½“ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/un.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_un</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sa_family_t sin_family</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åœ°å€æ—ï¼šAF_UNIX*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> sun_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">108</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*æ–‡ä»¶è·¯å¾„å*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>TCP/IPåè®®æ—æœ‰sockaddr_inå’Œsockaddr_in6ä¸¤ä¸ªä¸“ç”¨socketåœ°å€ç»“æ„ä½“ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºIPv4å’ŒIPv6ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sa_family_t sin_family</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åœ°å€æ—ï¼šAF_INET*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">u_int16_t sin_port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*ç«¯å£å·ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in_addr</span><span class="token plain"> sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*IPv4åœ°å€ç»“æ„ä½“ï¼Œè§ä¸‹é¢*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in_addr</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">u_int32_t s_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*IPv4åœ°å€ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in6</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sa_family_t sin6_family</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åœ°å€æ—ï¼šAF_INET6*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">u_int16_t sin6_port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*ç«¯å£å·ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">u_int32_t sin6_flowinfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*æµä¿¡æ¯ï¼Œåº”è®¾ç½®ä¸º0*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in6_addr</span><span class="token plain"> sin6_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*IPv6åœ°å€ç»“æ„ä½“ï¼Œè§ä¸‹é¢*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">u_int32_t sin6_scope_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*scope IDï¼Œå°šå¤„äºå®éªŒé˜¶æ®µ*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in6_addr</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> sa_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*IPv6åœ°å€ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>æ‰€æœ‰ä¸“ç”¨socketåœ°å€ï¼ˆä»¥åŠsockaddr_storageï¼‰ç±»å‹çš„å˜é‡åœ¨å®é™…ä½¿ç”¨æ—¶éƒ½éœ€è¦è½¬åŒ–ä¸ºé€šç”¨socketåœ°å€ç±»å‹sockaddrï¼ˆå¼ºåˆ¶è½¬æ¢å³å¯ï¼‰ï¼Œå› ä¸ºæ‰€æœ‰socketç¼–ç¨‹æ¥å£ä½¿ç”¨çš„åœ°å€å‚æ•°çš„ç±»å‹éƒ½æ˜¯sockaddrã€‚</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åˆ›å»ºä¸€ä¸ªIPv4 socketåœ°å€*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bzero</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_family </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">s_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inet_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0.0.0.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åˆ›å»ºä¸€ä¸ªIPv4 socketåœ°å€*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ip</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">inet_pton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ipåœ°å€è½¬æ¢å‡½æ•°"></a>IPåœ°å€è½¬æ¢å‡½æ•°<a class="hash-link" href="#ipåœ°å€è½¬æ¢å‡½æ•°" title="Direct link to heading">#</a></h4><p>ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„IPv4åœ°å€å’Œç”¨ç½‘ç»œå­—èŠ‚åºæ•´æ•°è¡¨ç¤ºçš„IPv4åœ°å€ä¹‹é—´çš„è½¬æ¢</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;arpa/inet.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„IPv4åœ°å€è½¬åŒ–ä¸ºç”¨ç½‘ç»œå­—èŠ‚åºæ•´æ•°è¡¨ç¤ºçš„IPv4åœ°å€ã€‚å®ƒå¤±è´¥æ—¶è¿”å›INADDR_NONEã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">in_addr_t </span><span class="token function" style="color:rgb(130, 170, 255)">inet_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">strptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°†è½¬åŒ–ç»“æœå­˜å‚¨äºå‚æ•°inpæŒ‡å‘çš„åœ°å€ç»“æ„ä¸­ã€‚å®ƒæˆåŠŸæ—¶è¿”å›1ï¼Œå¤±è´¥åˆ™è¿”å›0ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inet_aton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">cp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in_addr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">inp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°†ç”¨ç½‘ç»œå­—èŠ‚åºæ•´æ•°è¡¨ç¤ºçš„IPv4åœ°å€è½¬åŒ–ä¸ºç”¨ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„IPv4åœ°å€ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å‡½æ•°å†…éƒ¨ç”¨ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨è½¬åŒ–ç»“æœï¼Œå‡½æ•°çš„è¿”å›å€¼æŒ‡å‘è¯¥é™æ€å†…å­˜ï¼Œå› æ­¤inet_ntoaæ˜¯ä¸å¯é‡å…¥çš„ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">inet_ntoa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in_addr</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>inet_ntoaæ˜¯ä¸å¯é‡å…¥çš„</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">my_inet_ntoa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in_addr</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> __ip__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">p </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">s_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">sprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__ip__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d.%d.%d.%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> __ip__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> input_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">scanf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;input_ip = %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uint32_t ip = %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inet_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">in_addr</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">s_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inet_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Ip After Change : %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">my_inet_ntoa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ä¸‹é¢è¿™å¯¹æ›´æ–°çš„å‡½æ•°ä¹Ÿèƒ½å®Œæˆå’Œå‰é¢3ä¸ªå‡½æ•°åŒæ ·çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å®ƒä»¬åŒæ—¶é€‚ç”¨äºIPv4åœ°å€å’ŒIPv6åœ°å€ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;arpa/inet.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inet_pton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> af</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">src</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">inet_ntop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> af</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">src</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åˆ›å»ºä¸€ä¸ªIPv4 socketåœ°å€*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ip</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bzero</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_family</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">inet_pton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="åˆ›å»ºsocketæŒ‡å®šäº†åœ°å€æ—"></a>åˆ›å»ºsocket:æŒ‡å®šäº†åœ°å€æ—<a class="hash-link" href="#åˆ›å»ºsocketæŒ‡å®šäº†åœ°å€æ—" title="Direct link to heading">#</a></h3><p>UNIX/Linuxçš„ä¸€ä¸ªå“²å­¦æ˜¯ï¼šæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯æ–‡ä»¶ã€‚socketä¹Ÿä¸ä¾‹å¤–ï¼Œå®ƒå°±æ˜¯å¯è¯»ã€å¯å†™ã€å¯æ§åˆ¶ã€å¯å…³é—­çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/types.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> domain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> protocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><table><thead><tr><th></th><th>domain</th><th></th><th>type</th><th></th><th>protocol</th></tr></thead><tbody><tr><td>TCP/IPåè®®æ—</td><td>AF_INET</td><td>TCPåè®®</td><td>SOCK_STREAMï¼ˆæµæœåŠ¡ï¼‰</td><td></td><td>0</td></tr><tr><td>UNIXæœ¬åœ°åŸŸåè®®æ—</td><td>AF_UNIX</td><td>UDPåè®®</td><td>SOCK_UGRAMï¼ˆæ•°æ®æŠ¥ï¼‰</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td>SOCK_NONBLOCK</td><td></td><td></td></tr></tbody></table><p>protocolå‚æ•°æ˜¯åœ¨å‰ä¸¤ä¸ªå‚æ•°æ„æˆçš„åè®®é›†åˆä¸‹ï¼Œå†é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„åè®®ã€‚ä¸è¿‡è¿™ä¸ªå€¼é€šå¸¸éƒ½æ˜¯å”¯ä¸€çš„ï¼ˆå‰ä¸¤ä¸ªå‚æ•°å·²ç»å®Œå…¨å†³å®šäº†å®ƒçš„å€¼ï¼‰ã€‚å‡ ä¹åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥æŠŠå®ƒè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤åè®®ã€‚</p><p>socketç³»ç»Ÿè°ƒç”¨æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªsocketæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å‘½åsocketæŒ‡å®šsocketåœ°å€"></a>å‘½åsocket:æŒ‡å®šsocketåœ°å€<a class="hash-link" href="#å‘½åsocketæŒ‡å®šsocketåœ°å€" title="Direct link to heading">#</a></h3><p>åœ¨æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œé€šå¸¸è¦å‘½åsocketï¼Œå› ä¸ºåªæœ‰å‘½ååå®¢æˆ·ç«¯æ‰èƒ½çŸ¥é“è¯¥å¦‚ä½•è¿æ¥å®ƒã€‚</p><p>å®¢æˆ·ç«¯åˆ™é€šå¸¸ä¸éœ€è¦å‘½åsocketï¼Œè€Œæ˜¯é‡‡ç”¨åŒ¿åæ–¹å¼ï¼Œå³ä½¿ç”¨æ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„socketåœ°å€ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/types.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">my_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t addrlen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>bindå°†my_addræ‰€æŒ‡çš„socketåœ°å€åˆ†é…ç»™æœªå‘½åçš„sockfdæ–‡ä»¶æè¿°ç¬¦ï¼Œaddrlenå‚æ•°æŒ‡å‡ºè¯¥socketåœ°å€çš„é•¿åº¦ã€‚</p><p>bindæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚å…¶ä¸­ä¸¤ç§å¸¸è§çš„errnoæ˜¯EACCESå’ŒEADDRINUSEï¼Œå®ƒä»¬çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼š</p><ol><li>EACCESï¼Œè¢«ç»‘å®šçš„åœ°å€æ˜¯å—ä¿æŠ¤çš„åœ°å€ï¼Œä»…è¶…çº§ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ã€‚æ¯”å¦‚æ™®é€šç”¨æˆ·å°†socketç»‘å®šåˆ°çŸ¥åæœåŠ¡ç«¯å£ï¼ˆç«¯å£å·ä¸º0ï½1023ï¼‰ä¸Šæ—¶ï¼Œbindå°†è¿”å›EACCESé”™è¯¯ã€‚</li><li>EADDRINUSEï¼Œè¢«ç»‘å®šçš„åœ°å€æ­£åœ¨ä½¿ç”¨ä¸­ã€‚æ¯”å¦‚å°†socketç»‘å®šåˆ°ä¸€ä¸ªå¤„äºTIME_WAITçŠ¶æ€çš„socketåœ°å€ã€‚</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">socket_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sockfd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SOCK_STREAM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">setsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SOL_SOCKET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SO_REUSEADDR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_family </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_port </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">s_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inet_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0.0.0.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">listen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç›‘å¬socket"></a>ç›‘å¬socket<a class="hash-link" href="#ç›‘å¬socket" title="Direct link to heading">#</a></h3><p>åˆ›å»ºä¸€ä¸ªç›‘å¬é˜Ÿåˆ—ä»¥å­˜æ”¾å¾…å¤„ç†çš„å®¢æˆ·è¿æ¥</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">listen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> backlog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sockfdå‚æ•°æŒ‡å®šè¢«ç›‘å¬çš„socketã€‚backlogå‚æ•°æç¤ºå†…æ ¸ç›‘å¬é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚ç›‘å¬é˜Ÿåˆ—çš„é•¿åº¦å¦‚æœè¶…è¿‡backlogï¼ŒæœåŠ¡å™¨å°†ä¸å—ç†æ–°çš„å®¢æˆ·è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°†æ”¶åˆ°ECONNREFUSEDé”™è¯¯ä¿¡æ¯ã€‚</p><p>åœ¨å†…æ ¸ç‰ˆæœ¬2.2ä¹‹å‰çš„Linuxä¸­ï¼Œbacklogå‚æ•°æ˜¯æŒ‡æ‰€æœ‰å¤„äºåŠè¿æ¥çŠ¶æ€ï¼ˆSYN_RCVDï¼‰å’Œå®Œå…¨è¿æ¥çŠ¶æ€ï¼ˆESTABLISHEDï¼‰çš„socketçš„ä¸Šé™ã€‚</p><p>ä½†è‡ªå†…æ ¸ç‰ˆæœ¬2.2ä¹‹åï¼Œå®ƒåªè¡¨ç¤ºå¤„äºå®Œå…¨è¿æ¥çŠ¶æ€çš„socketçš„ä¸Šé™ï¼Œå¤„äºåŠè¿æ¥çŠ¶æ€çš„socketçš„ä¸Šé™åˆ™ç”±/<code>proc/sys/net/ipv4/tcp_max_syn_backlog</code>å†…æ ¸å‚æ•°å®šä¹‰ã€‚backlogå‚æ•°çš„å…¸å‹å€¼æ˜¯5ã€‚</p><p>listenæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æ¥å—è¿æ¥"></a>æ¥å—è¿æ¥<a class="hash-link" href="#æ¥å—è¿æ¥" title="Direct link to heading">#</a></h3><p>ç³»ç»Ÿè°ƒç”¨ä»listenç›‘å¬é˜Ÿåˆ—ä¸­æ¥å—ä¸€ä¸ªè¿æ¥ã€‚</p><p><strong>acceptåªæ˜¯ä»ç›‘å¬é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥ï¼Œè€Œä¸è®ºè¿æ¥å¤„äºä½•ç§çŠ¶æ€ï¼ˆå¦‚ä¸Šé¢çš„ESTABLISHEDçŠ¶æ€å’ŒCLOSE_WAITçŠ¶æ€ï¼‰ï¼Œæ›´ä¸å…³å¿ƒä»»ä½•ç½‘ç»œçŠ¶å†µçš„å˜åŒ–ã€‚</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/types.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">accept</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">addrlen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sockfdå‚æ•°æ˜¯æ‰§è¡Œè¿‡listenç³»ç»Ÿè°ƒç”¨çš„ç›‘å¬socket ã€‚</p><p>addrå‚æ•°ç”¨æ¥è·å–è¢«æ¥å—è¿æ¥çš„è¿œç«¯socketåœ°å€ï¼Œè¯¥socketåœ°å€çš„é•¿åº¦ç”±addrlenå‚æ•°æŒ‡å‡ºã€‚</p><p>acceptæˆåŠŸæ—¶è¿”å›ä¸€ä¸ªæ–°çš„è¿æ¥socketï¼Œè¯¥socketå”¯ä¸€åœ°æ ‡è¯†äº†è¢«æ¥å—çš„è¿™ä¸ªè¿æ¥ï¼ŒæœåŠ¡å™¨å¯é€šè¿‡è¯»å†™è¯¥socketæ¥ä¸è¢«æ¥å—è¿æ¥å¯¹åº”çš„å®¢æˆ·ç«¯é€šä¿¡ã€‚</p><p>acceptå¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><blockquote><p>æˆ‘ä»¬æŠŠæ‰§è¡Œè¿‡listenè°ƒç”¨ã€å¤„äºLISTENçŠ¶æ€çš„socketç§°ä¸ºç›‘å¬socketï¼Œè€Œæ‰€æœ‰å¤„äºESTABLISHEDçŠ¶æ€çš„socketåˆ™ç§°ä¸ºè¿æ¥socketã€‚</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å…³é—­è¿æ¥"></a>å…³é—­è¿æ¥<a class="hash-link" href="#å…³é—­è¿æ¥" title="Direct link to heading">#</a></h3><p>é—­ä¸€ä¸ªè¿æ¥å®é™…ä¸Šå°±æ˜¯å…³é—­è¯¥è¿æ¥å¯¹åº”çš„socket</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;unistd.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> fd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>fdå‚æ•°æ˜¯å¾…å…³é—­çš„socketã€‚ä¸è¿‡ï¼Œcloseç³»ç»Ÿè°ƒç”¨å¹¶éæ€»æ˜¯ç«‹å³å…³é—­ä¸€ä¸ªè¿æ¥ï¼Œè€Œæ˜¯å°†fdçš„å¼•ç”¨è®¡æ•°å‡1ã€‚åªæœ‰å½“fdçš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œæ‰çœŸæ­£å…³é—­è¿æ¥ã€‚å¤šè¿›ç¨‹ç¨‹åºä¸­ï¼Œä¸€æ¬¡forkç³»ç»Ÿè°ƒç”¨é»˜è®¤å°†ä½¿çˆ¶è¿›ç¨‹ä¸­æ‰“å¼€çš„socketçš„å¼•ç”¨è®¡æ•°åŠ 1ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­éƒ½å¯¹è¯¥socketæ‰§è¡Œcloseè°ƒç”¨æ‰èƒ½å°†è¿æ¥å…³é—­ã€‚</p><p>å¦‚æœæ— è®ºå¦‚ä½•éƒ½è¦ç«‹å³ç»ˆæ­¢è¿æ¥ï¼ˆè€Œä¸æ˜¯å°†socketçš„å¼•ç”¨è®¡æ•°å‡1ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„shutdownç³»ç»Ÿè°ƒç”¨ï¼ˆç›¸å¯¹äºcloseæ¥è¯´ï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºç½‘ç»œç¼–ç¨‹è®¾è®¡çš„ï¼‰ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> howto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sockfdå‚æ•°æ˜¯å¾…å…³é—­çš„socketã€‚howtoå‚æ•°å†³å®šäº†shutdownçš„è¡Œä¸º</p><p><img alt="image-20210908175054740" src="/assets/images/image-20210908175054740-2238fe41e973982468dda7c48f2a7514.png"></p><p>ç”±æ­¤å¯è§ï¼Œshutdownèƒ½å¤Ÿåˆ†åˆ«å…³é—­socketä¸Šçš„è¯»æˆ–å†™ï¼Œæˆ–è€…éƒ½å…³é—­ã€‚è€Œcloseåœ¨å…³é—­è¿æ¥æ—¶åªèƒ½å°†socketä¸Šçš„è¯»å’Œå†™åŒæ—¶å…³é—­ã€‚</p><p>shutdownæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><p><img src="https://camo.githubusercontent.com/2bd973e33aa86e292ceadff0a7afa391e618d587a60a7d0e9d3b5fabd24bf794/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f736f636b65742545352541452541322545362538382542372545372541422541462545362539432538442545352538412541312545352539392541382545392538302539412545382541452541462e6a7067" alt="Socket å®¢æˆ·ç«¯æœåŠ¡å™¨é€šè®¯"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tcp-çš„ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥"></a>TCP çš„ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥<a class="hash-link" href="#tcp-çš„ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥" title="Direct link to heading">#</a></h4><ol><li>å½“å®¢æˆ·ç«¯è°ƒç”¨ connect æ—¶ï¼Œè§¦å‘äº†è¿æ¥è¯·æ±‚ï¼Œå‘æœåŠ¡å™¨å‘é€äº† SYN J åŒ…ï¼Œè¿™æ—¶ connect è¿›å…¥é˜»å¡çŠ¶æ€ï¼›</li><li>æœåŠ¡å™¨ç›‘å¬åˆ°è¿æ¥è¯·æ±‚ï¼Œå³æ”¶åˆ° SYN J åŒ…ï¼Œè°ƒç”¨ accept å‡½æ•°æ¥æ”¶è¯·æ±‚å‘å®¢æˆ·ç«¯å‘é€ SYN K ï¼ŒACK J+1ï¼Œè¿™æ—¶ accept è¿›å…¥é˜»å¡çŠ¶æ€ï¼›</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ SYN K ï¼ŒACK J+1 ä¹‹åï¼Œè¿™æ—¶ connect è¿”å›ï¼Œå¹¶å¯¹ SYN K è¿›è¡Œç¡®è®¤ï¼›</li><li>æœåŠ¡å™¨æ”¶åˆ° ACK K+1 æ—¶ï¼Œaccept è¿”å›ï¼Œè‡³æ­¤ä¸‰æ¬¡æ¡æ‰‹å®Œæ¯•ï¼Œè¿æ¥å»ºç«‹ã€‚</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tcp-çš„å››æ¬¡æ¡æ‰‹é‡Šæ”¾è¿æ¥"></a>TCP çš„å››æ¬¡æ¡æ‰‹é‡Šæ”¾è¿æ¥<a class="hash-link" href="#tcp-çš„å››æ¬¡æ¡æ‰‹é‡Šæ”¾è¿æ¥" title="Direct link to heading">#</a></h4><ol><li>æŸä¸ªåº”ç”¨è¿›ç¨‹é¦–å…ˆè°ƒç”¨ close ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œè¿™æ—¶ TCP å‘é€ä¸€ä¸ª FIN Mï¼›</li><li>å¦ä¸€ç«¯æ¥æ”¶åˆ° FIN M ä¹‹åï¼Œæ‰§è¡Œè¢«åŠ¨å…³é—­ï¼Œå¯¹è¿™ä¸ª FIN è¿›è¡Œç¡®è®¤ã€‚å®ƒçš„æ¥æ”¶ä¹Ÿä½œä¸ºæ–‡ä»¶ç»“æŸç¬¦ä¼ é€’ç»™åº”ç”¨è¿›ç¨‹ï¼Œå› ä¸º FIN çš„æ¥æ”¶æ„å‘³ç€åº”ç”¨è¿›ç¨‹åœ¨ç›¸åº”çš„è¿æ¥ä¸Šå†ä¹Ÿæ¥æ”¶ä¸åˆ°é¢å¤–æ•°æ®ï¼›</li><li>ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæ¥æ”¶åˆ°æ–‡ä»¶ç»“æŸç¬¦çš„åº”ç”¨è¿›ç¨‹è°ƒç”¨ close å…³é—­å®ƒçš„ socketã€‚è¿™å¯¼è‡´å®ƒçš„ TCP ä¹Ÿå‘é€ä¸€ä¸ª FIN Nï¼›</li><li>æ¥æ”¶åˆ°è¿™ä¸ª FIN çš„æºå‘é€ç«¯ TCP å¯¹å®ƒè¿›è¡Œç¡®è®¤ã€‚</li></ol><p>è¿™æ ·æ¯ä¸ªæ–¹å‘ä¸Šéƒ½æœ‰ä¸€ä¸ª FIN å’Œ ACKã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æ•°æ®è¯»å†™"></a>æ•°æ®è¯»å†™<a class="hash-link" href="#æ•°æ®è¯»å†™" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="socket-ä¸­çš„-readã€write-å‡½æ•°"></a>Socket ä¸­çš„ read()ã€write() å‡½æ•°<a class="hash-link" href="#socket-ä¸­çš„-readã€write-å‡½æ•°" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><div tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">ssize_t</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> fd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">size_t</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">ssize_t</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> fd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">size_t</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="read"></a>read()<a class="hash-link" href="#read" title="Direct link to heading">#</a></h5><ul><li>read å‡½æ•°æ˜¯è´Ÿè´£ä» fd ä¸­è¯»å–å†…å®¹ã€‚</li><li>å½“è¯»æˆåŠŸæ—¶ï¼Œread è¿”å›å®é™…æ‰€è¯»çš„å­—èŠ‚æ•°ã€‚</li><li>å¦‚æœè¿”å›çš„å€¼æ˜¯ 0 è¡¨ç¤ºå·²ç»è¯»åˆ°æ–‡ä»¶çš„ç»“æŸäº†ï¼Œå°äº 0 è¡¨ç¤ºå‡ºç°äº†é”™è¯¯ã€‚</li><li>å¦‚æœé”™è¯¯ä¸º EINTR è¯´æ˜è¯»æ˜¯ç”±ä¸­æ–­å¼•èµ·çš„ï¼›å¦‚æœæ˜¯ ECONNREST è¡¨ç¤ºç½‘ç»œè¿æ¥å‡ºäº†é—®é¢˜ã€‚</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="write"></a>write()<a class="hash-link" href="#write" title="Direct link to heading">#</a></h5><ul><li>write å‡½æ•°å°† buf ä¸­çš„ nbytes å­—èŠ‚å†…å®¹å†™å…¥æ–‡ä»¶æè¿°ç¬¦ fdã€‚</li><li>æˆåŠŸæ—¶è¿”å›å†™çš„å­—èŠ‚æ•°ã€‚å¤±è´¥æ—¶è¿”å› -1ï¼Œå¹¶è®¾ç½® errno å˜é‡ã€‚</li><li>åœ¨ç½‘ç»œç¨‹åºä¸­ï¼Œå½“æˆ‘ä»¬å‘å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦å†™æ—¶æœ‰ä¿©ç§å¯èƒ½ã€‚</li><li>ï¼ˆ1ï¼‰write çš„è¿”å›å€¼å¤§äº 0ï¼Œè¡¨ç¤ºå†™äº†éƒ¨åˆ†æˆ–è€…æ˜¯å…¨éƒ¨çš„æ•°æ®ã€‚</li><li>ï¼ˆ2ï¼‰è¿”å›çš„å€¼å°äº 0ï¼Œæ­¤æ—¶å‡ºç°äº†é”™è¯¯ã€‚</li><li>å¦‚æœé”™è¯¯ä¸º EINTR è¡¨ç¤ºåœ¨å†™çš„æ—¶å€™å‡ºç°äº†ä¸­æ–­é”™è¯¯ï¼›å¦‚æœä¸º EPIPE è¡¨ç¤ºç½‘ç»œè¿æ¥å‡ºç°äº†é—®é¢˜ï¼ˆå¯¹æ–¹å·²ç»å…³é—­äº†è¿æ¥ï¼‰ã€‚</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tcpæ•°æ®è¯»å†™"></a>TCPæ•°æ®è¯»å†™<a class="hash-link" href="#tcpæ•°æ®è¯»å†™" title="Direct link to heading">#</a></h4><p>å¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œreadå’ŒwriteåŒæ ·é€‚ç”¨äºsocketã€‚ä½†æ˜¯socketç¼–ç¨‹æ¥å£æä¾›äº†å‡ ä¸ªä¸“é—¨ç”¨äºsocketæ•°æ®è¯»å†™çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒä»¬å¢åŠ äº†å¯¹æ•°æ®è¯»å†™çš„æ§åˆ¶ã€‚å…¶ä¸­ç”¨äºTCPæµæ•°æ®è¯»å†™çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/types.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssize_t </span><span class="token function" style="color:rgb(130, 170, 255)">recv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">size_t len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssize_t </span><span class="token function" style="color:rgb(130, 170, 255)">send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">size_t len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>è¯»å–sockfdä¸Šçš„æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šè¯»ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ï¼Œflagså‚æ•°é€šå¸¸è®¾ç½®ä¸º0å³å¯ã€‚recvæˆåŠŸæ—¶è¿”å›å®é™…è¯»å–åˆ°çš„æ•°æ®çš„é•¿åº¦ï¼Œå®ƒå¯èƒ½å°äºæˆ‘ä»¬æœŸæœ›çš„é•¿åº¦lenã€‚å› æ­¤æˆ‘ä»¬å¯èƒ½è¦å¤šæ¬¡è°ƒç”¨recvï¼Œæ‰èƒ½è¯»å–åˆ°å®Œæ•´çš„æ•°æ®ã€‚recvå¯èƒ½è¿”å›0ï¼Œè¿™æ„å‘³ç€é€šä¿¡å¯¹æ–¹å·²ç»å…³é—­è¿æ¥äº†ã€‚recvå‡ºé”™æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><p>sendå¾€sockfdä¸Šå†™å…¥æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šå†™ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ã€‚sendæˆåŠŸæ—¶è¿”å›å®é™…å†™å…¥çš„æ•°æ®çš„é•¿åº¦ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><p>flagså‚æ•°ä¸ºæ•°æ®æ”¶å‘æä¾›äº†é¢å¤–çš„æ§åˆ¶ï¼Œå®ƒå¯ä»¥å–è¡¨æ‰€ç¤ºé€‰é¡¹ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªçš„é€»è¾‘æˆ–ã€‚åªå¯¹sendå’Œrecvçš„å½“å‰è°ƒç”¨ç”Ÿæ•ˆï¼Œè€Œsetsockoptç³»ç»Ÿè°ƒç”¨æ°¸ä¹…æ€§åœ°ä¿®æ”¹socketçš„æŸäº›å±æ€§ã€‚</p><p><img alt="image-20210908175827923" src="/assets/images/image-20210908175827923-c318d4e6f02d8f8597914aa904968d5d.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="udpæ•°æ®è¯»å†™"></a>UDPæ•°æ®è¯»å†™<a class="hash-link" href="#udpæ•°æ®è¯»å†™" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/types.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssize_t </span><span class="token function" style="color:rgb(130, 170, 255)">recvfrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">size_t len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">src_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">addrlen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssize_t </span><span class="token function" style="color:rgb(130, 170, 255)">sendto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">size_t len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dest_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t addrlen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>recvfromè¯»å–sockfdä¸Šçš„æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šè¯»ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ã€‚å› ä¸ºUDPé€šä¿¡æ²¡æœ‰è¿æ¥çš„æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡è¯»å–æ•°æ®éƒ½éœ€è¦è·å–å‘é€ç«¯çš„socketåœ°å€ï¼Œå³å‚æ•°src_addræ‰€æŒ‡çš„å†…å®¹ï¼Œaddrlenå‚æ•°åˆ™æŒ‡å®šè¯¥åœ°å€çš„é•¿åº¦ã€‚</p><p>sendtoå¾€sockfdä¸Šå†™å…¥æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šå†™ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ã€‚dest_addrå‚æ•°æŒ‡å®šæ¥æ”¶ç«¯çš„socketåœ°å€ï¼Œaddrlenå‚æ•°åˆ™æŒ‡å®šè¯¥åœ°å€çš„é•¿åº¦ã€‚</p><p>recvfrom/sendtoç³»ç»Ÿè°ƒç”¨ä¹Ÿå¯ä»¥ç”¨äºé¢å‘è¿æ¥ï¼ˆSTREAMï¼‰çš„socketçš„æ•°æ®è¯»å†™ï¼Œåªéœ€è¦æŠŠæœ€åä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸ºNULLä»¥å¿½ç•¥å‘é€ç«¯/æ¥æ”¶ç«¯çš„socketåœ°å€ï¼ˆå› ä¸ºæˆ‘ä»¬å·²ç»å’Œå¯¹æ–¹å»ºç«‹äº†è¿æ¥ï¼Œæ‰€ä»¥å·²ç»çŸ¥é“å…¶socketåœ°å€äº†ï¼‰ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é€šç”¨æ•°æ®è¯»å†™å‡½æ•°"></a>é€šç”¨æ•°æ®è¯»å†™å‡½æ•°<a class="hash-link" href="#é€šç”¨æ•°æ®è¯»å†™å‡½æ•°" title="Direct link to heading">#</a></h4><p>é€šç”¨çš„æ•°æ®è¯»å†™ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒä»¬ä¸ä»…èƒ½ç”¨äºTCPæµæ•°æ®ï¼Œä¹Ÿèƒ½ç”¨äºUDPæ•°æ®æŠ¥ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssize_t </span><span class="token function" style="color:rgb(130, 170, 255)">recvmsg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">msghdr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssize_t </span><span class="token function" style="color:rgb(130, 170, 255)">sendmsg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">msghdr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sockfdå‚æ•°æŒ‡å®šè¢«æ“ä½œçš„ç›®æ ‡socketã€‚msgå‚æ•°æ˜¯msghdrç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œmsghdrç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">msghdr</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">msg_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*socketåœ°å€*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">socklen_t msg_namelen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*socketåœ°å€çš„é•¿åº¦*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">iovec</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">msg_iov</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åˆ†æ•£çš„å†…å­˜å—ï¼Œè§åæ–‡*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> msg_iovlen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åˆ†æ•£å†…å­˜å—çš„æ•°é‡*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">msg_control</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*æŒ‡å‘è¾…åŠ©æ•°æ®çš„èµ·å§‹ä½ç½®*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">socklen_t msg_controllen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*è¾…åŠ©æ•°æ®çš„å¤§å°*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> msg_flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*å¤åˆ¶å‡½æ•°ä¸­çš„flagså‚æ•°ï¼Œå¹¶åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­æ›´æ–°*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>msg_nameæˆå‘˜æŒ‡å‘ä¸€ä¸ªsocketåœ°å€ç»“æ„å˜é‡ã€‚å®ƒæŒ‡å®šé€šä¿¡å¯¹æ–¹çš„socketåœ°å€ã€‚å¯¹äºé¢å‘è¿æ¥çš„TCPåè®®ï¼Œè¯¥æˆå‘˜æ²¡æœ‰æ„ä¹‰ï¼Œå¿…é¡»è¢«è®¾ç½®ä¸ºNULLã€‚è¿™æ˜¯å› ä¸ºå¯¹æ•°æ®æµsocketè€Œè¨€ï¼Œå¯¹æ–¹çš„åœ°å€å·²ç»çŸ¥é“ã€‚msg_namelenæˆå‘˜åˆ™æŒ‡å®šäº†msg_nameæ‰€æŒ‡socketåœ°å€çš„é•¿åº¦ã€‚</p><p>msg_iovæˆå‘˜æ˜¯iovecç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œiovecç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">iovec</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">iov_base</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*å†…å­˜èµ·å§‹åœ°å€*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">size_t iov_len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*è¿™å—å†…å­˜çš„é•¿åº¦*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ï¼Œiovecç»“æ„ä½“å°è£…äº†ä¸€å—å†…å­˜çš„èµ·å§‹ä½ç½®å’Œé•¿åº¦ã€‚msg_iovlenæŒ‡å®šè¿™æ ·çš„iovecç»“æ„å¯¹è±¡æœ‰å¤šå°‘ä¸ªã€‚</p><p>å¯¹äºrecvmsgè€Œè¨€ï¼Œæ•°æ®å°†è¢«è¯»å–å¹¶å­˜æ”¾åœ¨msg_iovlenå—åˆ†æ•£çš„å†…å­˜ä¸­ï¼Œè¿™äº›å†…å­˜çš„ä½ç½®å’Œé•¿åº¦åˆ™ç”±msg_iovæŒ‡å‘çš„æ•°ç»„æŒ‡å®šï¼Œè¿™ç§°ä¸ºåˆ†æ•£è¯»ï¼ˆscatter readï¼‰ï¼›</p><p>å¯¹äºsendmsgè€Œè¨€ï¼Œmsg_iovlenå—åˆ†æ•£å†…å­˜ä¸­çš„æ•°æ®å°†è¢«ä¸€å¹¶å‘é€ï¼Œè¿™ç§°ä¸ºé›†ä¸­å†™ï¼ˆgather writeï¼‰ã€‚</p><p>msg_controlå’Œmsg_controllenæˆå‘˜ç”¨äºè¾…åŠ©æ•°æ®çš„ä¼ é€ã€‚æˆ‘ä»¬ä¸è¯¦ç»†è®¨è®ºå®ƒä»¬ï¼Œä»…åœ¨ç¬¬13ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥å®ç°åœ¨è¿›ç¨‹é—´ä¼ é€’æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>msg_flagsæˆå‘˜æ— é¡»è®¾å®šï¼Œå®ƒä¼šå¤åˆ¶recvmsg/sendmsgçš„flagså‚æ•°çš„å†…å®¹ä»¥å½±å“æ•°æ®è¯»å†™è¿‡ç¨‹ã€‚recvmsgè¿˜ä¼šåœ¨è°ƒç”¨ç»“æŸå‰ï¼Œå°†æŸäº›æ›´æ–°åçš„æ ‡å¿—è®¾ç½®åˆ°msg_flagsä¸­ã€‚</p><p>recvmsg/sendmsgçš„flagså‚æ•°ä»¥åŠè¿”å›å€¼çš„å«ä¹‰å‡ä¸send/recvçš„flagså‚æ•°åŠè¿”å›å€¼ç›¸åŒã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¸¦å¤–æ ‡è®°"></a>å¸¦å¤–æ ‡è®°<a class="hash-link" href="#å¸¦å¤–æ ‡è®°" title="Direct link to heading">#</a></h3><p>got 5 bytes of normal data&#x27;123ab&#x27;</p><p>got 1 bytes of oob data&#x27;c&#x27;</p><p>got 3 bytes of normal data&#x27;123&#x27;</p><hr><p>ç”±æ­¤å¯è§ï¼Œå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„3å­—èŠ‚çš„å¸¦å¤–æ•°æ®â€œabcâ€ä¸­ï¼Œä»…æœ‰æœ€åä¸€ä¸ªå­—ç¬¦â€œcâ€è¢«æœåŠ¡å™¨å½“æˆçœŸæ­£çš„å¸¦å¤–æ•°æ®æ¥æ”¶ï¼ˆæ­£å¦‚3.8èŠ‚è®¨è®ºçš„é‚£æ ·ï¼‰ã€‚å¹¶ä¸”ï¼ŒæœåŠ¡å™¨å¯¹æ­£å¸¸æ•°æ®çš„æ¥æ”¶å°†è¢«å¸¦å¤–æ•°æ®æˆªæ–­ï¼Œå³å‰ä¸€éƒ¨åˆ†æ­£å¸¸æ•°æ®â€œ123abâ€å’Œåç»­çš„æ­£å¸¸æ•°æ®â€œ123â€æ˜¯ä¸èƒ½è¢«ä¸€ä¸ªrecvè°ƒç”¨å…¨éƒ¨è¯»å‡ºçš„ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æ— æ³•é¢„æœŸå¸¦å¤–æ•°æ®ä½•æ—¶åˆ°æ¥ã€‚</p><p>Linuxå†…æ ¸æ£€æµ‹åˆ°TCPç´§æ€¥æ ‡å¿—æ—¶ï¼Œå°†é€šçŸ¥åº”ç”¨ç¨‹åºæœ‰å¸¦å¤–æ•°æ®éœ€è¦æ¥æ”¶ã€‚å†…æ ¸é€šçŸ¥åº”ç”¨ç¨‹åºå¸¦å¤–æ•°æ®åˆ°è¾¾çš„ä¸¤ç§å¸¸è§æ–¹å¼æ˜¯ï¼šI/Oå¤ç”¨äº§ç”Ÿçš„å¼‚å¸¸äº‹ä»¶å’ŒSIGURGä¿¡å·ã€‚ä½†æ˜¯ï¼Œå³ä½¿åº”ç”¨ç¨‹åºå¾—åˆ°äº†æœ‰å¸¦å¤–æ•°æ®éœ€è¦æ¥æ”¶çš„é€šçŸ¥ï¼Œè¿˜éœ€è¦çŸ¥é“å¸¦å¤–æ•°æ®åœ¨æ•°æ®æµä¸­çš„å…·ä½“ä½ç½®ï¼Œæ‰èƒ½å‡†ç¡®æ¥æ”¶å¸¦å¤–æ•°æ®ã€‚è¿™ä¸€ç‚¹å¯é€šè¿‡å¦‚ä¸‹ç³»ç»Ÿè°ƒç”¨å®ç°ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sockatmark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sockatmarkåˆ¤æ–­sockfdæ˜¯å¦å¤„äºå¸¦å¤–æ ‡è®°ï¼Œå³ä¸‹ä¸€ä¸ªè¢«è¯»å–åˆ°çš„æ•°æ®æ˜¯å¦æ˜¯å¸¦å¤–æ•°æ®ã€‚å¦‚æœæ˜¯ï¼Œsockatmarkè¿”å›1ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å¸¦MSG_OOBæ ‡å¿—çš„recvè°ƒç”¨æ¥æ¥æ”¶å¸¦å¤–æ•°æ®ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™sockatmarkè¿”å›0ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="åœ°å€ä¿¡æ¯å‡½æ•°"></a>åœ°å€ä¿¡æ¯å‡½æ•°<a class="hash-link" href="#åœ°å€ä¿¡æ¯å‡½æ•°" title="Direct link to heading">#</a></h3><p>ä¸€ä¸ªè¿æ¥socketçš„æœ¬ç«¯socketåœ°å€ï¼Œä»¥åŠè¿œç«¯çš„socketåœ°å€ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getsockname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">address_len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getpeername</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">address_len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>getsocknameè·å–sockfdå¯¹åº”çš„æœ¬ç«¯socketåœ°å€ï¼Œå¹¶å°†å…¶å­˜å‚¨äºaddresså‚æ•°æŒ‡å®šçš„å†…å­˜ä¸­ï¼Œè¯¥socketåœ°å€çš„é•¿åº¦åˆ™å­˜å‚¨äºaddress_lenå‚æ•°æŒ‡å‘çš„å˜é‡ä¸­ã€‚å¦‚æœå®é™…socketåœ°å€çš„é•¿åº¦å¤§äºaddressæ‰€æŒ‡å†…å­˜åŒºçš„å¤§å°ï¼Œé‚£ä¹ˆè¯¥socketåœ°å€å°†è¢«æˆªæ–­ã€‚getsocknameæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><p>getpeernameè·å–sockfdå¯¹åº”çš„è¿œç«¯socketåœ°å€ï¼Œå…¶å‚æ•°åŠè¿”å›å€¼çš„å«ä¹‰ä¸getsocknameçš„å‚æ•°åŠè¿”å›å€¼ç›¸åŒã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="socketé€‰é¡¹"></a>socketé€‰é¡¹<a class="hash-link" href="#socketé€‰é¡¹" title="Direct link to heading">#</a></h3><p>å¦‚æœè¯´fcntlç³»ç»Ÿè°ƒç”¨æ˜¯æ§åˆ¶æ–‡ä»¶æè¿°ç¬¦å±æ€§çš„é€šç”¨POSIXæ–¹æ³•ï¼Œé‚£ä¹ˆä¸‹é¢ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨åˆ™æ˜¯ä¸“é—¨ç”¨æ¥è¯»å–å’Œè®¾ç½®socketæ–‡ä»¶æè¿°ç¬¦å±æ€§çš„æ–¹æ³•ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sys/socket.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> option_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">option_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">restrict option_len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sockfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> option_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">option_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">socklen_t option_len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sockfdå‚æ•°æŒ‡å®šè¢«æ“ä½œçš„ç›®æ ‡socketã€‚levelå‚æ•°æŒ‡å®šè¦æ“ä½œå“ªä¸ªåè®®çš„é€‰é¡¹ï¼ˆå³å±æ€§ï¼‰ï¼Œæ¯”å¦‚IPv4ã€IPv6ã€TCPç­‰ã€‚option_nameå‚æ•°åˆ™æŒ‡å®šé€‰é¡¹çš„åå­—ã€‚æˆ‘ä»¬åœ¨è¡¨5-5ä¸­åˆ—ä¸¾äº†socketé€šä¿¡ä¸­å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„socketé€‰é¡¹ã€‚option_valueå’Œoption_lenå‚æ•°åˆ†åˆ«æ˜¯è¢«æ“ä½œé€‰é¡¹çš„å€¼å’Œé•¿åº¦ã€‚ä¸åŒçš„é€‰é¡¹å…·æœ‰ä¸åŒç±»å‹çš„å€¼</p><p>getsockoptå’Œsetsockoptè¿™ä¸¤ä¸ªå‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚</p><p><img alt="image-20210908180910572" src="/assets/images/image-20210908180910572-d6ae5de74addaf8171e50efc02119504.png"></p><p>éƒ¨åˆ†socketé€‰é¡¹åªèƒ½åœ¨è°ƒç”¨listenç³»ç»Ÿè°ƒç”¨å‰é’ˆå¯¹ç›‘å¬socketï¼Œè®¾ç½®æ‰æœ‰æ•ˆã€‚è¿™æ˜¯å› ä¸ºè¿æ¥socketåªèƒ½ç”±acceptè°ƒç”¨è¿”å›ï¼Œè€Œacceptä»listenç›‘å¬é˜Ÿåˆ—ä¸­æ¥å—çš„è¿æ¥è‡³å°‘å·²ç»å®Œæˆäº†TCPä¸‰æ¬¡æ¡æ‰‹çš„å‰ä¸¤ä¸ªæ­¥éª¤ï¼ˆå› ä¸ºlistenç›‘å¬é˜Ÿåˆ—ä¸­çš„è¿æ¥è‡³å°‘å·²è¿›å…¥SYN_RCVDçŠ¶æ€ï¼Œè¯´æ˜æœåŠ¡å™¨å·²ç»å¾€è¢«æ¥å—è¿æ¥ä¸Šå‘é€å‡ºäº†TCPåŒæ­¥æŠ¥æ–‡æ®µã€‚ä½†æœ‰çš„socketé€‰é¡¹å´åº”è¯¥åœ¨TCPåŒæ­¥æŠ¥æ–‡æ®µä¸­è®¾ç½®ï¼Œæ¯”å¦‚TCPæœ€å¤§æŠ¥æ–‡æ®µé€‰é¡¹ï¼ˆå›å¿†3.2.2å°èŠ‚ï¼Œè¯¥é€‰é¡¹åªèƒ½ç”±åŒæ­¥æŠ¥æ–‡æ®µæ¥å‘é€ï¼‰ã€‚</p><p>å¯¹ç›‘å¬socketè®¾ç½®è¿™äº›socketé€‰é¡¹ï¼Œé‚£ä¹ˆacceptè¿”å›çš„è¿æ¥socketå°†è‡ªåŠ¨ç»§æ‰¿è¿™äº›é€‰é¡¹ã€‚è¿™äº›socketé€‰é¡¹åŒ…æ‹¬ï¼šSO_DEBUGã€SO_DONTROUTEã€SO_KEEPALIVEã€SO_LINGERã€SO_OOBINLINEã€SO_RCVBUFã€SO_RCVLOWATã€SO_SNDBUFã€SO_SNDLOWATã€TCP_MAXSEGå’ŒTCP_NODELAYã€‚è€Œå¯¹å®¢æˆ·ç«¯è€Œè¨€ï¼Œè¿™äº›socketé€‰é¡¹åˆ™åº”è¯¥åœ¨è°ƒç”¨connectå‡½æ•°ä¹‹å‰è®¾ç½®ï¼Œå› ä¸ºconnectè°ƒç”¨æˆåŠŸè¿”å›ä¹‹åï¼ŒTCPä¸‰æ¬¡æ¡æ‰‹å·²å®Œæˆã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="so_reuseaddré€‰é¡¹"></a>SO_REUSEADDRé€‰é¡¹<a class="hash-link" href="#so_reuseaddré€‰é¡¹" title="Direct link to heading">#</a></h4><p>è®¾ç½®socketé€‰é¡¹SO_REUSEADDRæ¥å¼ºåˆ¶ä½¿ç”¨è¢«å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥å ç”¨çš„socketåœ°å€</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#é‡ç”¨æœ¬åœ°åœ°å€</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sock</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">PF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOCK_STREAM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> reuse</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">setsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOL_SOCKET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SO_REUSEADDR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†reuse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">reuse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bzero</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_family</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">inet_pton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> ret</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>é€šè¿‡ä¿®æ”¹å†…æ ¸å‚æ•°<code>/proc/sys/net/ipv4/tcp_tw_recycle</code>æ¥å¿«é€Ÿå›æ”¶è¢«å…³é—­çš„socketï¼Œä»è€Œä½¿å¾—TCPè¿æ¥æ ¹æœ¬å°±ä¸è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œè¿›è€Œå…è®¸åº”ç”¨ç¨‹åºç«‹å³é‡ç”¨æœ¬åœ°çš„socketåœ°å€ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="so_rcvbufå’Œso_sndbufé€‰é¡¹"></a>SO_RCVBUFå’ŒSO_SNDBUFé€‰é¡¹<a class="hash-link" href="#so_rcvbufå’Œso_sndbufé€‰é¡¹" title="Direct link to heading">#</a></h4><p>SO_RCVBUFå’ŒSO_SNDBUFé€‰é¡¹åˆ†åˆ«è¡¨ç¤ºTCPæ¥æ”¶ç¼“å†²åŒºå’Œå‘é€ç¼“å†²åŒºçš„å¤§å°ã€‚</p><p>å½“æˆ‘ä»¬ç”¨setsockoptæ¥è®¾ç½®TCPçš„æ¥æ”¶ç¼“å†²åŒºå’Œå‘é€ç¼“å†²åŒºçš„å¤§å°æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šå°†å…¶å€¼åŠ å€ï¼Œå¹¶ä¸”ä¸å¾—å°äºæŸä¸ªæœ€å°å€¼ã€‚TCPæ¥æ”¶ç¼“å†²åŒºçš„æœ€å°å€¼æ˜¯256å­—èŠ‚ï¼Œè€Œå‘é€ç¼“å†²åŒºçš„æœ€å°å€¼æ˜¯2048å­—èŠ‚ï¼ˆä¸è¿‡ï¼Œä¸åŒçš„ç³»ç»Ÿå¯èƒ½æœ‰ä¸åŒçš„é»˜è®¤æœ€å°å€¼ï¼‰ã€‚</p><p>ç³»ç»Ÿè¿™æ ·åšçš„ç›®çš„ï¼Œä¸»è¦æ˜¯ç¡®ä¿ä¸€ä¸ªTCPè¿æ¥æ‹¥æœ‰è¶³å¤Ÿçš„ç©ºé—²ç¼“å†²åŒºæ¥å¤„ç†æ‹¥å¡ï¼ˆæ¯”å¦‚å¿«é€Ÿé‡ä¼ ç®—æ³•å°±æœŸæœ›TCPæ¥æ”¶ç¼“å†²åŒºèƒ½è‡³å°‘å®¹çº³4ä¸ªå¤§å°ä¸ºSMSSçš„TCPæŠ¥æ–‡æ®µï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹å†…æ ¸å‚æ•°<code>/proc/sys/net/ipv4/tcp_rmem</code>å’Œ<code>proc/sys/net/ipv4/tcp_wmem</code>æ¥å¼ºåˆ¶TCPæ¥æ”¶ç¼“å†²åŒºå’Œå‘é€ç¼“å†²åŒºçš„å¤§å°æ²¡æœ‰æœ€å°å€¼é™åˆ¶ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#ä¿®æ”¹TCPå‘é€ç¼“å†²åŒºçš„å®¢æˆ·ç«¯ç¨‹åº</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ip</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">atoi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bzero</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ï¼†server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_family</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">inet_pton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sock</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">PF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOCK_STREAM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sendbuf</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">atoi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> len</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sendbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*å…ˆè®¾ç½®TCPå‘é€ç¼“å†²åŒºçš„å¤§å°ï¼Œç„¶åç«‹å³è¯»å–ä¹‹*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">setsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOL_SOCKET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SO_SNDBUF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†sendbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sendbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">getsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOL_SOCKET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SO_SNDBUF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†sendbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ï¼†len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;the tcp send buffer size after setting is%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">sendbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ï¼†server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">server_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">memset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;a&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#ä¿®æ”¹TCPæ¥æ”¶ç¼“å†²åŒºçš„æœåŠ¡å™¨ç¨‹åº</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ip</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">atoi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">bzero</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_family</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">inet_pton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sin_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">htons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sock</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">PF_INET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOCK_STREAM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> recvbuf</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">atoi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> len</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">recvbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*å…ˆè®¾ç½®TCPæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼Œç„¶åç«‹å³è¯»å–ä¹‹*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">setsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOL_SOCKET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SO_RCVBUF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†recvbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">recvbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">getsockopt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SOL_SOCKET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SO_RCVBUF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†recvbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">socklen_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ï¼†len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;the tcp receive buffer size after settting is%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">recvbuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> ret</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ï¼†address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret</span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ret</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">listen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret</span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr_in</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">socklen_t client_addrlength</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> connfd</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">accept</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">sockaddr</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ï¼†client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ï¼†client_addrlength</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">connfd</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;errno is:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">errno</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">memset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;\0&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">recv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">BUFFER_SIZE</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="so_rcvlowatå’Œso_sndlowaté€‰é¡¹"></a>SO_RCVLOWATå’ŒSO_SNDLOWATé€‰é¡¹<a class="hash-link" href="#so_rcvlowatå’Œso_sndlowaté€‰é¡¹" title="Direct link to heading">#</a></h4><p>SO_RCVLOWATå’ŒSO_SNDLOWATé€‰é¡¹åˆ†åˆ«è¡¨ç¤ºTCPæ¥æ”¶ç¼“å†²åŒºå’Œå‘é€ç¼“å†²åŒºçš„ä½æ°´ä½æ ‡è®°ã€‚å®ƒä»¬ä¸€èˆ¬è¢«I/Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨ç”¨æ¥åˆ¤æ–­socketæ˜¯å¦å¯è¯»æˆ–å¯å†™ã€‚</p><p>å½“TCPæ¥æ”¶ç¼“å†²åŒºä¸­å¯è¯»æ•°æ®çš„æ€»æ•°å¤§äºå…¶ä½æ°´ä½æ ‡è®°æ—¶ï¼ŒI/Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨å°†é€šçŸ¥åº”ç”¨ç¨‹åºå¯ä»¥ä»å¯¹åº”çš„socketä¸Šè¯»å–æ•°æ®ï¼›å½“TCPå‘é€ç¼“å†²åŒºä¸­çš„ç©ºé—²ç©ºé—´ï¼ˆå¯ä»¥å†™å…¥æ•°æ®çš„ç©ºé—´ï¼‰å¤§äºå…¶ä½æ°´ä½æ ‡è®°æ—¶ï¼ŒI/Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨å°†é€šçŸ¥åº”ç”¨ç¨‹åºå¯ä»¥å¾€å¯¹åº”çš„sockeä¸Šå†™å…¥æ•°æ®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTCPæ¥æ”¶ç¼“å†²åŒºçš„ä½æ°´ä½æ ‡è®°å’ŒTCPå‘é€ç¼“å†²åŒºçš„ä½æ°´ä½æ ‡è®°å‡ä¸º1å­—èŠ‚ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç½‘ç»œä¿¡æ¯api"></a>ç½‘ç»œä¿¡æ¯API<a class="hash-link" href="#ç½‘ç»œä¿¡æ¯api" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gethostbynameå’Œgethostbyaddr"></a>gethostbynameå’Œgethostbyaddr<a class="hash-link" href="#gethostbynameå’Œgethostbyaddr" title="Direct link to heading">#</a></h4><p>thostbynameå‡½æ•°æ ¹æ®ä¸»æœºåç§°è·å–ä¸»æœºçš„å®Œæ•´ä¿¡æ¯ï¼Œgethostbyaddrå‡½æ•°æ ¹æ®IPåœ°å€è·å–ä¸»æœºçš„å®Œæ•´ä¿¡æ¯ã€‚</p><p>gethostbynameå‡½æ•°é€šå¸¸å…ˆåœ¨æœ¬åœ°çš„<code>/etc/hosts</code>é…ç½®æ–‡ä»¶ä¸­æŸ¥æ‰¾ä¸»æœºï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå†å»è®¿é—®DNSæœåŠ¡å™¨ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;netdb.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">hostent</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">gethostbyname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">hostent</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">gethostbyaddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">size_t len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>nameå‚æ•°æŒ‡å®šç›®æ ‡ä¸»æœºçš„ä¸»æœºåï¼Œaddrå‚æ•°æŒ‡å®šç›®æ ‡ä¸»æœºçš„IPåœ°å€ï¼Œlenå‚æ•°æŒ‡å®šaddræ‰€æŒ‡IPåœ°å€çš„é•¿åº¦ï¼Œtypeå‚æ•°æŒ‡å®šaddræ‰€æŒ‡IPåœ°å€çš„ç±»å‹ï¼Œå…¶åˆæ³•å–å€¼åŒ…æ‹¬AF_INETï¼ˆç”¨äºIPv4åœ°å€ï¼‰å’ŒAF_INET6ï¼ˆç”¨äºIPv6åœ°å€ï¼‰ã€‚</p><p>è¿™ä¸¤ä¸ªå‡½æ•°è¿”å›çš„éƒ½æ˜¯hostentç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œhostentç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;netdb.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">hostent</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">h_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*ä¸»æœºå*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">h_aliases</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*ä¸»æœºåˆ«ååˆ—è¡¨ï¼Œå¯èƒ½æœ‰å¤šä¸ª*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> h_addrtype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åœ°å€ç±»å‹ï¼ˆåœ°å€æ—ï¼‰*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> h_length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*åœ°å€é•¿åº¦*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">h_addr_list</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*æŒ‰ç½‘ç»œå­—èŠ‚åºåˆ—å‡ºçš„ä¸»æœºIPåœ°å€åˆ—è¡¨*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="getservbynameå’Œgetservbyport"></a>getservbynameå’Œgetservbyport<a class="hash-link" href="#getservbynameå’Œgetservbyport" title="Direct link to heading">#</a></h4><p>getservbynameå‡½æ•°æ ¹æ®åç§°è·å–æŸä¸ªæœåŠ¡çš„å®Œæ•´ä¿¡æ¯ï¼Œgetservbyportå‡½æ•°æ ¹æ®ç«¯å£å·è·å–æŸä¸ªæœåŠ¡çš„å®Œæ•´ä¿¡æ¯ã€‚å®ƒä»¬å®é™…ä¸Šéƒ½æ˜¯é€šè¿‡è¯»å–<code>/etc/services</code>ä»¶æ¥è·å–æœåŠ¡çš„ä¿¡æ¯çš„ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;netdb.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">servent</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">getservbyname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">proto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">servent</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token function" style="color:rgb(130, 170, 255)">getservbyport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">proto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>nameå‚æ•°æŒ‡å®šç›®æ ‡æœåŠ¡çš„åå­—ï¼Œportå‚æ•°æŒ‡å®šç›®æ ‡æœåŠ¡å¯¹åº”çš„ç«¯å£å·ã€‚protoå‚æ•°æŒ‡å®šæœåŠ¡ç±»å‹ï¼Œç»™å®ƒä¼ é€’â€œtcpâ€è¡¨ç¤ºè·å–æµæœåŠ¡ï¼Œç»™å®ƒä¼ é€’â€œudpâ€è¡¨ç¤ºè·å–æ•°æ®æŠ¥æœåŠ¡ï¼Œç»™å®ƒä¼ é€’NULLåˆ™è¡¨ç¤ºè·å–æ‰€æœ‰ç±»å‹çš„æœåŠ¡ã€‚</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/worst0/wiki_note/edit/main/docs/8.Server/C1.ç½‘ç»œAPI.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Server/B9.å‘½ä»¤"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« B9.å‘½ä»¤</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Server/C1.ç½‘ç»œç¼–ç¨‹"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">C1.ç½‘ç»œç¼–ç¨‹ Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#linuxç½‘ç»œç¼–ç¨‹åŸºç¡€api" class="table-of-contents__link">Linuxç½‘ç»œç¼–ç¨‹åŸºç¡€API</a><ul><li><a href="#socketåœ°å€api" class="table-of-contents__link">socketåœ°å€API</a></li><li><a href="#åˆ›å»ºsocketæŒ‡å®šäº†åœ°å€æ—" class="table-of-contents__link">åˆ›å»ºsocket:æŒ‡å®šäº†åœ°å€æ—</a></li><li><a href="#å‘½åsocketæŒ‡å®šsocketåœ°å€" class="table-of-contents__link">å‘½åsocket:æŒ‡å®šsocketåœ°å€</a></li><li><a href="#ç›‘å¬socket" class="table-of-contents__link">ç›‘å¬socket</a></li><li><a href="#æ¥å—è¿æ¥" class="table-of-contents__link">æ¥å—è¿æ¥</a></li><li><a href="#å…³é—­è¿æ¥" class="table-of-contents__link">å…³é—­è¿æ¥</a></li><li><a href="#æ•°æ®è¯»å†™" class="table-of-contents__link">æ•°æ®è¯»å†™</a></li><li><a href="#socket-ä¸­çš„-readã€write-å‡½æ•°" class="table-of-contents__link">Socket ä¸­çš„ read()ã€write() å‡½æ•°</a></li><li><a href="#å¸¦å¤–æ ‡è®°" class="table-of-contents__link">å¸¦å¤–æ ‡è®°</a></li><li><a href="#åœ°å€ä¿¡æ¯å‡½æ•°" class="table-of-contents__link">åœ°å€ä¿¡æ¯å‡½æ•°</a></li><li><a href="#socketé€‰é¡¹" class="table-of-contents__link">socketé€‰é¡¹</a></li><li><a href="#ç½‘ç»œä¿¡æ¯api" class="table-of-contents__link">ç½‘ç»œä¿¡æ¯API</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8bd170ed.js"></script>
<script src="/assets/js/main.30834e93.js"></script>
</body>
</html>