<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Wiki Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">D2.cache | My Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://worst0.github.io/Operating_system/D2.cache"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="D2.cache | My Wiki"><meta data-react-helmet="true" name="description" content="体系架构神书《Computer Architecture : A Quantitative Approach》 计算机体系结构"><meta data-react-helmet="true" property="og:description" content="体系架构神书《Computer Architecture : A Quantitative Approach》 计算机体系结构"><meta data-react-helmet="true" property="og:image" content="https://cos.ap-guangzhou.myqcloud.com/wiki-media-1253965369/doc/logo-zip.png"><meta data-react-helmet="true" name="twitter:image" content="https://cos.ap-guangzhou.myqcloud.com/wiki-media-1253965369/doc/logo-zip.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://worst0.github.io/Operating_system/D2.cache"><link data-react-helmet="true" rel="alternate" href="https://worst0.github.io/Operating_system/D2.cache" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://worst0.github.io/Operating_system/D2.cache" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.fcc94c76.css">
<link rel="preload" href="/assets/js/runtime~main.aad5aa0c.js" as="script">
<link rel="preload" href="/assets/js/main.800b3dd8.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Wiki</b></a><a class="navbar__item navbar__link" href="/intro">Document💻</a><a class="navbar__item navbar__link" href="/blog">Blog🤓</a><a class="navbar__item navbar__link" href="/ReadingNotes/A1.Sentence">Reading-Book📚</a><a class="navbar__item navbar__link" href="/Xmind_IMG/1.解题思维">Xmind🎮</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/worst0/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/worst0/wiki_note" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>本站源码<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">🌙</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Wiki logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Wiki</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/intro">Document💻</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog🤓</a></li><li class="menu__list-item"><a class="menu__link" href="/ReadingNotes/A1.Sentence">Reading-Book📚</a></li><li class="menu__list-item"><a class="menu__link" href="/Xmind_IMG/1.解题思维">Xmind🎮</a></li><li class="menu__list-item"><a href="https://github.com/worst0/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/worst0/wiki_note" target="_blank" rel="noopener noreferrer" class="menu__link"><span>本站源码<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">D2.cache</h1></header><p>体系架构神书《Computer Architecture : A Quantitative Approach》 计算机体系结构    </p><p><img alt="图片" src="/assets/images/cache-001-884b6e9740e5d078bebaf5be05658a07.png"></p><h3></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1为什么需要-cache"></a>1、为什么需要 Cache<a class="hash-link" href="#1为什么需要-cache" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="11-为什么需要-cache"></a>1.1 为什么需要 Cache<a class="hash-link" href="#11-为什么需要-cache" title="Direct link to heading">#</a></h3><p><img alt="图片" src="/assets/images/cache-3-36863d0fc94e6ad097a79d3a2ad804d4.png"></p><p>上图是 CPU 性能和 Memory 存储器访问性能的发展。</p><p>随着工艺和设计的演进，CPU 计算性能剧增，但是DRAM存储性能的发展并不快。所以造成存储限制了计算的发展。容量与速度不可兼得。</p><p>从计算访问数据的规律入手。<strong>我们访问的数据有局部性。</strong></p><p><strong>Cache是为了给CPU提供高速存储访问，利用数据局部性而设计的小存储单元。</strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="12-实际系统中的-cache"></a>1.2 实际系统中的 Cache<a class="hash-link" href="#12-实际系统中的-cache" title="Direct link to heading">#</a></h3><p><img alt="图片" src="/assets/images/cache-2-7e6d137a6f25b5b2f5f86506b9ee842e.png"></p><p>整个系统的存储架构包括了 CPU 的寄存器，L1/L2/L3 CACHE，DRAM 和硬盘。</p><p>数据访问时先找寄存器，寄存器里没有找 L1 Cache, L1 Cache 里没有找 L2 Cache 依次类推，最后找到硬盘中。</p><p>速度与存储容量的折衷关系。容量越小，访问速度越快</p><p><img alt="图片" src="data:image/png;base64,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"></p><p>CPU 和 Cache 是 word 传输的，而 Cache 到主存是以块传输的，一块大约 64Byte 。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2cache的工作原理"></a>2、Cache的工作原理<a class="hash-link" href="#2cache的工作原理" title="Direct link to heading">#</a></h2><ul><li>数据如何放置</li><li>数据如何查询</li><li>数据如何被替换</li><li>如果发生了写操作，Cache如何处理</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-数据如何放置"></a>2.1 数据如何放置<a class="hash-link" href="#21-数据如何放置" title="Direct link to heading">#</a></h4><p>三种方法：</p><ul><li>全相连（Fully associative）。可以放在Cache的任何位置。</li><li>直接映射（Direct mapped）。只允许放在Cache的某一行。比如12 mod 8</li><li>组相连（set associative）。可以放在Cache的某几行。例如2路组相连，一共有4组，所以可以放在0,1位置中的一个。</li></ul><p>不同的放置方式主要影响有两点：</p><p>1、组相连组数越大，比较电路就越大，但Cache利用率更高，Cache miss发生的概率小。</p><p>2、组相连数目变小，Cache经常发生替换，但是比较电路比较小。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-如何在cache中找数据"></a>2.2 如何在Cache中找数据<a class="hash-link" href="#22-如何在cache中找数据" title="Direct link to heading">#</a></h4><p><img alt="图片" src="/assets/images/cache-5-409791ac23bd8f27219377896424a6f3.png"></p><p>T表示Tag。直接比较Tag，就能得知是不是命中了。如果命中了，则根据index(组号）将对应的块取出来即可。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-如何替换cache中的数据"></a>2.3 如何替换Cache中的数据<a class="hash-link" href="#23-如何替换cache中的数据" title="Direct link to heading">#</a></h4><p><img alt="图片" src="data:image/png;base64,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"></p><ul><li>随机替换。如果发生Cache miss里随机替换掉一块。</li><li>Least recently used. LRU。最近使用的块最后替换。</li><li>First in, first out (FIFO), 先进先出。</li></ul><p>Cache 在什么时候数据会被替换内？也有几种策略。</p><ul><li>不在本 Cache 替换。如果Cache miss了，直接转发访问地址到主存，取到的数据不会写到Cache.</li><li>在读MISS时替换。如果读的时候Cache里没有该数据，则从主存读取该数据后写入Cache。</li><li>在写MISS时替换。如果写的时候Cache里没有该数据，则将本数据调入Cache再写。</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="24-如果发生了写操作怎么办"></a>2.4 如果发生了写操作怎么办<a class="hash-link" href="#24-如果发生了写操作怎么办" title="Direct link to heading">#</a></h4><p>Cache毕竟是个临时缓存。</p><p>如果发生了写操作，会造成Cache和主存中的数据不一致。如何保证写数据操作正确呢？</p><p>也有三种策略。</p><ul><li><p>通写：直接把数据写回Cache的同时写回主存。极其影响写速度。
<img alt="图片" src="data:image/png;base64,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"></p></li><li><p>回写：先把数据写回Cache, 然后当Cache的数据被替换时再写回主存。
<img alt="图片" src="data:image/png;base64,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"></p></li><li><p>通写队列：通写与回写的结合。先写回一个队列，然后慢慢往主存储写。如果多次写同一个数据，直接写这个队列。避免频繁写主存。</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3cache一致性"></a>3、Cache一致性<a class="hash-link" href="#3cache一致性" title="Direct link to heading">#</a></h3><p>什么原因需要 Cache 处理一致性呢？</p><p>主要是多核系统中，假如core 0读了主存储的数据，写了数据。core 1也读了主从的数据。这个时候core 1并不知道数据已经被改动了，也就是说，core 1 Cache中的数据过时了，会产生错误。</p><p>Cache一致性的保证就是让多核访问不出错。</p><p><strong>Cache一致性主要有两种策略。</strong></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="策略一基于监听的一致性策略"></a>策略一：基于监听的一致性策略<a class="hash-link" href="#策略一基于监听的一致性策略" title="Direct link to heading">#</a></h4><p>这种策略是所有Cache均监听各Cache的写操作，如果一个Cache中的数据被写了，有两种处理办法。</p><p><strong>写更新协议：</strong>某个Cache发生写了，就索性把所有Cache都给更新了。</p><p><strong>写失效协议：</strong>某个Cache发生写了，就把其他Cache中的该数据块置为无效。</p><p>策略 1 由于监听起来成本比较大，所以只应用于极简单的系统中。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="策略二基于目录的一致性策略"></a>策略二：基于目录的一致性策略<a class="hash-link" href="#策略二基于目录的一致性策略" title="Direct link to heading">#</a></h4><p>这种策略是在主存处维护一张表。记录各数据块都被写到了哪些Cache, 从而更新相应的状态。一般来讲这种策略采用的比较多。又分为下面几个常用的策略。</p><ul><li>SI: 对于一个数据块来讲，有share和invalid两种状态。如果是share状态，直接通知其他Cache, 将对应的块置为无效。</li><li>MSI：对于一个数据块来讲，有share和invalid，modified三种状态。其中modified状态表表示该数据只属于这个Cache,  被修改过了。当这个数据被逐出Cache时更新主存。这么做的好处是避免了大量的主从写入。同时，如果是invalid时写该数据，就要保证其他所有Cache里该数据的标志位不为M，负责要先写回主存储。</li><li>MESI：对于一个数据来讲，有4个状态。modified, invalid, shared, exclusive。其中exclusive状态用于标识该数据与其他Cache不依赖。要写的时候直接将该Cache状态改成M即可。</li></ul><p><img alt="图片" src="/assets/images/cache-9-8b5cbaa8c5f288df90fc2772cd515ffb.png"></p><p>当前状态时I状态时，如果发生处理器读操作 prrd。</p><ul><li>如果其他Cache里有这份数据，如果其他Cache里是M态，先 把M态写回主存再读。否则直接读。最终状态变为S。</li><li>其他Cache里没这个数据，直接变到E状态。</li></ul><p>当前状态为S态。</p><ul><li>如果发生了处理器读操作，仍然在S态。</li><li>如果发生了处理器写操作，则跳转到M状态。</li><li>如果其他Cache发生了写操作，跳到I态。</li></ul><p>当前状态E态</p><ul><li>发生了处理器读操作还是E。</li><li>发生了处理器写操作变成M。</li><li>如果其他Cache发生了读操作，变到S状态。</li></ul><p>当前状态M态</p><ul><li>发生了读操作依旧是M态。</li><li>发生了写操作依旧是M态。</li><li>如果其他Cache发生了读操作，则将数据写回主存储，变换到S态。</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/worst0/wiki_note/edit/main/docs/6.Operating_system/D2.cache.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1为什么需要-cache" class="table-of-contents__link">1、为什么需要 Cache</a><ul><li><a href="#11-为什么需要-cache" class="table-of-contents__link">1.1 为什么需要 Cache</a></li><li><a href="#12-实际系统中的-cache" class="table-of-contents__link">1.2 实际系统中的 Cache</a></li></ul></li><li><a href="#2cache的工作原理" class="table-of-contents__link">2、Cache的工作原理</a><ul><li><a href="#3cache一致性" class="table-of-contents__link">3、Cache一致性</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aad5aa0c.js"></script>
<script src="/assets/js/main.800b3dd8.js"></script>
</body>
</html>